<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>gRenderDX9: d3dApp.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<h1>d3dApp.h</h1><div class="fragment"><pre>00001 <span class="comment">//-----------------------------------------------------------------------------</span>
00002 <span class="comment">// File: D3DApp.h</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// Desc: Application class for the Direct3D samples framework library.</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
00007 <span class="comment">//-----------------------------------------------------------------------------</span>
00008 <span class="preprocessor">#ifndef __D3DAPP_H__</span>
00009 <span class="preprocessor"></span><span class="preprocessor">#define __D3DAPP_H__</span>
00010 <span class="preprocessor"></span>
00011 <span class="comment">//-----------------------------------------------------------------------------</span>
00012 <span class="comment">// Error codes</span>
00013 <span class="comment">//-----------------------------------------------------------------------------</span>
00014 <span class="keyword">enum</span> APPMSGTYPE { MSG_NONE, MSGERR_APPMUSTEXIT, MSGWARN_SWITCHEDTOREF };
00015 
00016 <span class="preprocessor">#define D3DAPPERR_NODIRECT3D          0x82000001</span>
00017 <span class="preprocessor"></span><span class="preprocessor">#define D3DAPPERR_NOWINDOW            0x82000002</span>
00018 <span class="preprocessor"></span><span class="preprocessor">#define D3DAPPERR_NOCOMPATIBLEDEVICES 0x82000003</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#define D3DAPPERR_NOWINDOWABLEDEVICES 0x82000004</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#define D3DAPPERR_NOHARDWAREDEVICE    0x82000005</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#define D3DAPPERR_HALNOTCOMPATIBLE    0x82000006</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define D3DAPPERR_NOWINDOWEDHAL       0x82000007</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define D3DAPPERR_NODESKTOPHAL        0x82000008</span>
00024 <span class="preprocessor"></span><span class="preprocessor">#define D3DAPPERR_NOHALTHISMODE       0x82000009</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define D3DAPPERR_NONZEROREFCOUNT     0x8200000a</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#define D3DAPPERR_MEDIANOTFOUND       0x8200000b</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define D3DAPPERR_RESETFAILED         0x8200000c</span>
00028 <span class="preprocessor"></span><span class="preprocessor">#define D3DAPPERR_NULLREFDEVICE       0x8200000d</span>
00029 <span class="preprocessor"></span>
00030 
00031 
00032 
00033 <span class="comment">//-----------------------------------------------------------------------------</span>
00034 <span class="comment">// Name: class D3DApplication</span>
00035 <span class="comment">// Desc: A base class for creating sample D3D9 applications. To create a simple</span>
00036 <span class="comment">//       Direct3D application, simply derive this class into a class (such as</span>
00037 <span class="comment">//       class CMyD3DApplication) and override the following functions, as </span>
00038 <span class="comment">//       needed:</span>
00039 <span class="comment">//          OneTimeSceneInit()    - To initialize app data (alloc mem, etc.)</span>
00040 <span class="comment">//          InitDeviceObjects()   - To initialize the 3D scene objects</span>
00041 <span class="comment">//          Render()              - To render the scene</span>
00042 <span class="comment">//          DeleteDeviceObjects() - To cleanup the 3D scene objects</span>
00043 <span class="comment">//          FinalCleanup()        - To cleanup app data (for exitting the app)</span>
00044 <span class="comment">//          MsgProc()             - To handle Windows messages</span>
00045 <span class="comment">//-----------------------------------------------------------------------------</span>
00046 <span class="keyword">class </span>D3DApplication
00047 {
00048 <span class="keyword">protected</span>:
00049     D3DEnumeration          m_d3dEnum;
00050     D3DSettings             m_d3dSettings;
00051 
00052     <span class="comment">// Internal variables for the state of the app</span>
00053     <span class="keywordtype">bool</span>                    m_bWindowed;
00054     <span class="keywordtype">bool</span>                    m_bActive;
00055     <span class="keywordtype">bool</span>                    m_bDeviceLost;
00056     <span class="keywordtype">bool</span>                    m_bMinimized;
00057     <span class="keywordtype">bool</span>                    m_bMaximized;
00058     <span class="keywordtype">bool</span>                    m_bIgnoreSizeChange;
00059     <span class="keywordtype">bool</span>                    m_bDeviceObjectsInited;
00060     <span class="keywordtype">bool</span>                    m_bDeviceObjectsRestored;
00061 
00062     <span class="comment">// Internal variables used for timing</span>
00063     <span class="keywordtype">bool</span>                    m_bFrameMoving;
00064     <span class="keywordtype">bool</span>                    m_bSingleStep;
00065 
00066     <span class="comment">// Internal error handling function</span>
00067     HRESULT                 DisplayErrorMsg( HRESULT hr, DWORD dwType );
00068 
00069     <span class="comment">// Internal functions to manage and render the 3D scene</span>
00070     <span class="keyword">static</span> <span class="keywordtype">bool</span>             ConfirmDeviceHelper( D3DCAPS9* pCaps, VertexProcessingType vertexProcessingType, 
00071                                                     D3DFORMAT adapterFormat, D3DFORMAT backBufferFormat );
00072     <span class="keywordtype">bool</span>                    FindBestWindowedMode( <span class="keywordtype">bool</span> bRequireHAL, <span class="keywordtype">bool</span> bRequireREF );
00073     <span class="keywordtype">bool</span>                    FindBestFullscreenMode( <span class="keywordtype">bool</span> bRequireHAL, <span class="keywordtype">bool</span> bRequireREF );
00074     HRESULT                 ChooseInitialD3DSettings();
00075     HRESULT                 Initialize3DEnvironment();
00076     HRESULT                 HandlePossibleSizeChange();
00077     HRESULT                 Reset3DEnvironment();
00078     HRESULT                 ToggleFullscreen();
00079     HRESULT                 ForceWindowed();
00080     HRESULT                 UserSelectNewDevice();
00081     <span class="keywordtype">void</span>                    Cleanup3DEnvironment();
00082     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            BuildPresentParamsFromSettings();
00083     <span class="keyword">virtual</span> HRESULT         AdjustWindowForChange();
00084     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            UpdateStats();
00085     <span class="keywordtype">bool</span>                    SupportsInstancing();
00086     <span class="keyword">const</span> D3DCAPS9&amp;         GetCaps()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_d3dSettings.PDeviceInfo()-&gt;m_Caps; }
00087     <span class="keywordtype">int</span>                     GetBackBufferW()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_d3dsdBackBuffer.Width; }
00088     <span class="keywordtype">int</span>                     GetBackBufferH()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_d3dsdBackBuffer.Height; }
00089 
00090 <span class="keyword">protected</span>:
00091     <span class="comment">// Main objects used for creating and rendering the 3D scene</span>
00092     D3DPRESENT_PARAMETERS   m_d3dpp;                <span class="comment">// Parameters for CreateDevice/Reset</span>
00093     HWND                    m_hWnd;                 <span class="comment">// The main app window</span>
00094     HWND                    m_hWndFocus;            <span class="comment">// The D3D focus window (usually same as m_hWnd)</span>
00095     HMENU                   m_hMenu;                <span class="comment">// App menu bar (stored here when fullscreen)</span>
00096     LPDIRECT3D9             m_pD3D;                 <span class="comment">// The main D3D object</span>
00097     LPDIRECT3DDEVICE9       m_pDevice;              <span class="comment">// The D3D rendering device</span>
00098     D3DCAPS9                m_Caps;                 <span class="comment">// Caps for the device</span>
00099     D3DSURFACE_DESC         m_d3dsdBackBuffer;      <span class="comment">// Surface desc of the backbuffer</span>
00100     DWORD                   m_dwCreateFlags;        <span class="comment">// Indicate sw or hw vertex processing</span>
00101     DWORD                   m_dwWindowStyle;        <span class="comment">// Saved window style for mode switches</span>
00102     RECT                    m_rcWindowBounds;       <span class="comment">// Saved window bounds for mode switches</span>
00103     RECT                    m_rcWindowClient;       <span class="comment">// Saved client area size for mode switches</span>
00104 
00105     DEVMODE                 m_InitialDesktopMode;
00106 
00107     WNDPROC                 m_HostWndProc;          <span class="comment">// Host window window procedure</span>
00108 
00109     <span class="comment">// Variables for timing</span>
00110     FLOAT                   m_fTime;                <span class="comment">// Current time in seconds</span>
00111     FLOAT                   m_fElapsedTime;         <span class="comment">// Time elapsed since last frame</span>
00112     FLOAT                   m_fFPS;                 <span class="comment">// Instanteous frame rate</span>
00113     TCHAR                   m_strDeviceStats[90];   <span class="comment">// String to hold D3D device stats</span>
00114     TCHAR                   m_strFrameStats[90];    <span class="comment">// String to hold frame stats</span>
00115 
00116     <span class="comment">// Overridable variables for the app</span>
00117     TCHAR*                  m_strWindowTitle;    <span class="comment">// Title for the app's window</span>
00118     DWORD                   m_dwCreationWidth;   <span class="comment">// Width used to create window</span>
00119     DWORD                   m_dwCreationHeight;  <span class="comment">// Height used to create window</span>
00120     <span class="keywordtype">bool</span>                    m_bShowCursorWhenFullscreen; <span class="comment">// Whether to show cursor when fullscreen</span>
00121     <span class="keywordtype">bool</span>                    m_bClipCursorWhenFullscreen; <span class="comment">// Whether to limit cursor pos when fullscreen</span>
00122     <span class="keywordtype">bool</span>                    m_bStartFullscreen;  <span class="comment">// Whether to start up the app in fullscreen mode</span>
00123     <span class="keywordtype">bool</span>                    m_bCreateMultithreadDevice; <span class="comment">// Whether to create a multithreaded device</span>
00124     <span class="keywordtype">bool</span>                    m_bAllowDialogBoxMode; <span class="comment">// If enabled the framework will try to enable GDI dialogs while in fullscreen</span>
00125 
00126     <span class="comment">// Overridable functions for the 3D scene created by the app</span>
00127     <span class="keyword">virtual</span> HRESULT         ConfirmDevice(D3DCAPS9*,DWORD,D3DFORMAT,D3DFORMAT) { <span class="keywordflow">return</span> S_OK; }
00128     <span class="keyword">virtual</span> HRESULT         OneTimeSceneInit()                         { <span class="keywordflow">return</span> S_OK; }
00129     <span class="keyword">virtual</span> HRESULT         InitDeviceObjects()                        { <span class="keywordflow">return</span> S_OK; }
00130     <span class="keyword">virtual</span> HRESULT         RestoreDeviceObjects()                     { <span class="keywordflow">return</span> S_OK; }
00131     <span class="keyword">virtual</span> HRESULT         InvalidateDeviceObjects()                  { <span class="keywordflow">return</span> S_OK; }
00132     <span class="keyword">virtual</span> HRESULT         DeleteDeviceObjects()                      { <span class="keywordflow">return</span> S_OK; }
00133     <span class="keyword">virtual</span> HRESULT         FinalCleanup()                             { <span class="keywordflow">return</span> S_OK; }
00134 
00135 <span class="keyword">public</span>:
00136     <span class="comment">//  functions to create, run, pause, and clean up the application</span>
00137     <span class="keyword">virtual</span> HRESULT         Create          ( HINSTANCE hInstance, HWND hWnd );
00138     <span class="keyword">virtual</span> LRESULT         MsgProc         ( HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam );
00139 
00140     LRESULT                 HostWndProc     ( HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam );
00141 
00142     <span class="keyword">virtual</span>                 ~D3DApplication () { }
00143 
00144     <span class="comment">// Internal constructor</span>
00145     D3DApplication();
00146 };  <span class="comment">// class D3DApplication</span>
00147 
00148 <span class="preprocessor">#endif // __D3DAPP_H__</span>
00149 <span class="preprocessor"></span>
00150 
00151 
</pre></div><hr><address style="align: right;"><small>
Generated on Tue Jun 13 11:14:33 2006 for gRenderDX9 by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.1 using KingsTools</small></address>
</body>
</html>
