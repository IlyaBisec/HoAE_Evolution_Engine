<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>gRenderDX9: d3dShaderFX.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<h1>d3dShaderFX.h</h1><div class="fragment"><pre>00001 <span class="comment">/*****************************************************************************/</span>
00002 <span class="comment">/*  File:   d3dShaderFX.h</span>
00003 <span class="comment">/*  Desc:   ShaderFX interface implementation for DirectX9 </span>
00004 <span class="comment">/*  Author: Ruslan Shestopalyuk</span>
00005 <span class="comment">/*  Date:   02.11.2004</span>
00006 <span class="comment">/*****************************************************************************/</span>
00007 <span class="preprocessor">#ifndef __D3DSHADERFX_H__</span>
00008 <span class="preprocessor"></span><span class="preprocessor">#define __D3DSHADERFX_H__</span>
00009 <span class="preprocessor"></span><span class="preprocessor">#include "IShader.h"</span>
00010 <span class="preprocessor">#include "IResourceManager.h"</span>
00011 <span class="preprocessor">#include "kTimer.h"</span>
00012 
00014 <span class="comment">//#define DEBUG_PS   // Uncomment this line to debug pixel shaders </span>
00015  
00016 <span class="comment">/*****************************************************************************/</span>
00017 <span class="comment">/*  Union: ShaderVarValue</span>
00018 <span class="comment">/*  Desc: </span>
00019 <span class="comment">/*****************************************************************************/</span>
<a name="l00020"></a><a class="code" href="unionShaderVarValue.html">00020</a> <span class="keyword">union </span><a class="code" href="unionShaderVarValue.html">ShaderVarValue</a> 
00021 {
00022     <span class="keywordtype">int</span>                 nVal;       
00023     <span class="keywordtype">bool</span>                bVal;       
00024     <span class="keywordtype">float</span>               fVal;       
00025     <span class="keywordtype">float</span>               vVal[4];    
00026     <span class="keywordtype">float</span>               mVal[16];   
00027 }; <span class="comment">// union ShaderVarValue</span>
00028 
00029 <span class="comment">/*****************************************************************************/</span>
00030 <span class="comment">/*  Struct: ShaderFXVariable</span>
00031 <span class="comment">/*  Desc:   </span>
00032 <span class="comment">/*****************************************************************************/</span>
00033 <span class="keyword">struct </span>ShaderFXVariable
00034 {
00035     std::string         m_Name;
00036     ShaderVarType       m_Type;
00037     <a class="code" href="unionShaderVarValue.html">ShaderVarValue</a>      m_Value;
00038     D3DXHANDLE          m_Handle;
00039     <span class="keywordtype">bool</span>                m_bAuto;
00040 }; <span class="comment">// struct ShaderFXVar</span>
00041 
00042 <span class="keyword">struct </span>ShaderFXTechnique
00043 {
00044     std::string         m_Name;
00045     D3DXHANDLE          m_Handle;
00046     <span class="keywordtype">int</span>                 m_NPasses;
00047     <span class="keywordtype">int</span>                 m_NAnnotations;
00048 }; <span class="comment">// struct ShaderFXTechnique</span>
00049 
00050 <span class="keyword">struct </span>ShaderFXAutoVar
00051 {
00052     <span class="keywordtype">int</span>                 m_Idx;
00053     AutoShaderVariable  m_Type;
00054 }; <span class="comment">// struct ShaderFXAutoVar</span>
00055 
00056 <span class="keyword">class </span>ShaderFX;
00057 <span class="comment">/*****************************************************************************/</span>
00058 <span class="comment">/*  Class:  FXIncluder</span>
00059 <span class="comment">/*  Desc:   Used for providing shader file including to effect compiler</span>
00060 <span class="comment">/*****************************************************************************/</span>
00061 <span class="keyword">class </span>FXIncluder : <span class="keyword">public</span> ID3DXInclude
00062 {
00063     DWORD       m_ResID;
00064     BYTE*       m_pData;
00065     ShaderFX*   m_pCurShader;
00066 
00067 <span class="keyword">public</span>:
00068     FXIncluder() : m_ResID(0xFFFFFFFF), m_pData(NULL), m_pCurShader(NULL){}
00069     <span class="keyword">virtual</span> HRESULT __stdcall Open( D3DXINCLUDE_TYPE IncludeType, LPCSTR pFileName, 
00070                                     LPCVOID pParentData, LPCVOID *ppData, UINT *pBytes );
00071     <span class="keyword">virtual</span> HRESULT __stdcall Close( LPCVOID pData );
00072 
00073     <span class="keywordtype">void</span> SetCurShader( ShaderFX* pShader );
00074 }; <span class="comment">// class FXIncluder</span>
00075 
00076 <span class="comment">/*****************************************************************************/</span>
00077 <span class="comment">/*  Class:  ShaderFX</span>
00078 <span class="comment">/*  Desc:   Direct3D9 .fx shader class </span>
00079 <span class="comment">/*****************************************************************************/</span>
00080 <span class="keyword">class </span>ShaderFX : <span class="keyword">public</span> IShader, <span class="keyword">public</span> IResource
00081 {
00082     ID3DXEffect*                    m_pEffect;          <span class="comment">//  pointer to the d3dx effect interface</span>
00083     std::vector&lt;ShaderFXVariable&gt;   m_Variables;        <span class="comment">//  variables list</span>
00084     std::vector&lt;ShaderFXAutoVar&gt;    m_AutoVars;         <span class="comment">//  automatic variables references</span>
00085     std::vector&lt;ShaderFXTechnique&gt;  m_Techniques;       <span class="comment">//  techniques list</span>
00086 
00087     std::string                     m_Name;             <span class="comment">//  effect name</span>
00088     std::string                     m_FileName;         <span class="comment">//  effect file name</span>
00089     <span class="keywordtype">int</span>                             m_ID;               <span class="comment">//  effect ID in the shader manager</span>
00090     <span class="keywordtype">int</span>                             m_ActiveTech;       <span class="comment">//  currently aclive technique</span>
00091     <span class="keyword">static</span> Timer                    s_Timer;
00092 
00093 <span class="keyword">public</span>:
00094                                 ShaderFX        ( IDirect3DDevice9* pDevice );
00095                                 ShaderFX        ();
00096                                 ~ShaderFX       ();
00097 
00098     <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>*         GetName         ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_Name.c_str(); }
00099     <span class="keyword">virtual</span> <span class="keywordtype">int</span>                 GetID           ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_ID; }
00100     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                SetID           ( <span class="keywordtype">int</span> id ) { m_ID = id; }
00101 
00102     <span class="keyword">virtual</span> <span class="keywordtype">int</span>                 GetNTech        () <span class="keyword">const</span>;
00103     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                SetActiveTech   ( <span class="keywordtype">int</span> techID ) { m_ActiveTech = techID; <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00104     <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>*         GetTechName     ( <span class="keywordtype">int</span> techID ) <span class="keyword">const</span>;
00105     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                IsTechValid     ( <span class="keywordtype">int</span> techID ) <span class="keyword">const</span>;
00106 
00107     <span class="keyword">virtual</span> <span class="keywordtype">int</span>                 GetNPasses      ( <span class="keywordtype">int</span> techID = 0 ) <span class="keyword">const</span>;
00108     <span class="keyword">virtual</span> <span class="keywordtype">int</span>                 GetNShaderVars  ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_Variables.size(); }
00109     <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>*         GetVariableName ( <span class="keywordtype">int</span> cID ) <span class="keyword">const</span>;
00110     <span class="keyword">virtual</span> <span class="keywordtype">int</span>                 GetShaderVarID  ( <span class="keyword">const</span> <span class="keywordtype">char</span>* cName );
00111 
00112     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                SetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keywordtype">bool</span> val );
00113     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                SetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keywordtype">float</span> val );
00114     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                SetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keywordtype">int</span> val );
00115     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                SetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keyword">const</span> Matrix4D&amp; val );
00116     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                SetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keyword">const</span> Vector4D&amp; val );
00117     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                SetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keyword">const</span> Vector3D&amp; val );
00118 
00119     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                GetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keywordtype">bool</span>&amp; val );
00120     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                GetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keywordtype">float</span>&amp; val );
00121     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                GetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keywordtype">int</span>&amp; val );
00122     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                GetShaderVar    ( <span class="keywordtype">int</span> cID, Matrix4D&amp; val );
00123     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                GetShaderVar    ( <span class="keywordtype">int</span> cID, Vector4D&amp; val );
00124     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                GetShaderVar    ( <span class="keywordtype">int</span> cID, Vector3D&amp; val );
00125 
00126     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                SetAutoVars     ();
00127     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                IsAutoVar       ( <span class="keywordtype">int</span> cID );
00128 
00129     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                Load            ( <span class="keyword">const</span> <span class="keywordtype">char</span>* fName );
00130     
00131     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                Begin           ();
00132     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                BeginPass       ( <span class="keywordtype">int</span> passID );
00133     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                EndPass         ();
00134     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                End             ();
00135     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                Reload          ();
00136     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                SetName         ( <span class="keyword">const</span> <span class="keywordtype">char</span>* name ) { m_Name = name; }
00137 
00138     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                DeleteDeviceObjects     ();
00139     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                InvalidateDeviceObjects ();
00140     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                RestoreDeviceObjects    ();
00141 
00142 <span class="keyword">protected</span>:
00143     <span class="keywordtype">void</span>                        EnumerateVariables      ();
00144     <span class="keywordtype">void</span>                        EnumerateTechniques     ();
00145     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                LoadFromFile            ( <span class="keyword">const</span> <span class="keywordtype">char</span>* fName );
00146     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                LoadFromMemory          ( <span class="keyword">const</span> BYTE* pBuf, <span class="keywordtype">int</span> bufSize );
00147     <a class="code" href="unionShaderVarValue.html">ShaderVarValue</a>              GetVariableValue        ( D3DXHANDLE h, ShaderVarType type );
00148 
00149     <span class="keyword">static</span> FXIncluder           s_FXIncluder;
00150 }; <span class="comment">// class ShaderFX</span>
00151 
00152 <span class="comment">/*****************************************************************/</span>
00153 <span class="comment">/*  Class:  ShaderError</span>
00154 <span class="comment">/*  Desc:   "No shader" stub</span>
00155 <span class="comment">/*****************************************************************/</span>
00156 <span class="keyword">class </span>ShaderError : <span class="keyword">public</span> IShader, <span class="keyword">public</span> IResource
00157 {
00158     std::string                     m_Name;
00159     <span class="keywordtype">int</span>                             m_ID;
00160 
00161 <span class="keyword">public</span>:
00162     ShaderError() : m_ID(-1) {}
00163     <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>*             GetName         ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_Name.c_str(); }
00164     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                    SetName         ( <span class="keyword">const</span> <span class="keywordtype">char</span>* name ) { m_Name = name; }
00165 
00166     <span class="keyword">virtual</span> <span class="keywordtype">int</span>                     GetID           ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_ID; }
00167     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                    SetID           ( <span class="keywordtype">int</span> id ) { m_ID = id; }
00168 
00169     <span class="keyword">virtual</span> <span class="keywordtype">int</span>                     GetNTech        ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> 0; }
00170     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    IsTechValid     ( <span class="keywordtype">int</span> techID )<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00171     <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>*             GetTechName     ( <span class="keywordtype">int</span> techID )<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">""</span>; }
00172     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    SetActiveTech   ( <span class="keywordtype">int</span> techID ) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00173 
00174     <span class="keyword">virtual</span> <span class="keywordtype">int</span>                     GetNPasses      ( <span class="keywordtype">int</span> techID = 0 )<span class="keyword"> const </span>{ <span class="keywordflow">return</span> 0; }
00175     <span class="keyword">virtual</span> <span class="keywordtype">int</span>                     GetNShaderVars  ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> 0; }
00176     <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>*             GetVariableName ( <span class="keywordtype">int</span> cID )<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">""</span>; }
00177     <span class="keyword">virtual</span> <span class="keywordtype">int</span>                     GetShaderVarID  ( <span class="keyword">const</span> <span class="keywordtype">char</span>* cName ) { <span class="keywordflow">return</span> 0; }
00178 
00179     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    SetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keywordtype">bool</span> val ) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00180     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    SetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keywordtype">float</span> val ) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00181     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    SetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keywordtype">int</span> val ) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00182     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    SetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keyword">const</span> Matrix4D&amp; val ) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00183     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    SetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keyword">const</span> Vector4D&amp; val ) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00184     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    SetShaderVar    ( <span class="keywordtype">int</span> cID, <span class="keyword">const</span> Vector3D&amp; val ) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00185     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                    SetAutoVars     () {}
00186 
00187     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    LoadFromFile    ( <span class="keyword">const</span> <span class="keywordtype">char</span>* fName ) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00188     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    LoadFromMemory  ( <span class="keyword">const</span> BYTE* pBuf, <span class="keywordtype">int</span> bufSize ){ <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00189 
00190     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    Begin           () { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00191     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    BeginPass       ( <span class="keywordtype">int</span> passID ) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00192     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    EndPass         () { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00193     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    End             () { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00194 
00195     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                    Reload          () { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00196 
00197     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                    DeleteDeviceObjects     () {}
00198     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                    InvalidateDeviceObjects () {}
00199     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                    RestoreDeviceObjects    () {}
00200 }; <span class="comment">// class ShaderError</span>
00201 
00202 <span class="keyword">inline</span> ShaderVarType GetShaderVarType( D3DXPARAMETER_CLASS cl, D3DXPARAMETER_TYPE vt )
00203 {
00204     <span class="keywordflow">if</span> (cl == D3DXPC_SCALAR)
00205     {
00206         <span class="keywordflow">if</span> (vt == D3DXPT_BOOL   ) <span class="keywordflow">return</span> svtBool;   
00207         <span class="keywordflow">if</span> (vt == D3DXPT_FLOAT  ) <span class="keywordflow">return</span> svtFloat;     
00208         <span class="keywordflow">if</span> (vt == D3DXPT_INT    ) <span class="keywordflow">return</span> svtInt;    
00209     }
00210     <span class="keywordflow">if</span> (cl == D3DXPC_VECTOR) <span class="keywordflow">return</span> svtVector; 
00211     <span class="keywordflow">if</span> (cl == D3DXPC_MATRIX_COLUMNS) <span class="keywordflow">return</span> svtMatrix; 
00212     <span class="keywordflow">if</span> (cl == D3DXPC_MATRIX_ROWS) <span class="keywordflow">return</span> svtMatrix; 
00213     <span class="keywordflow">return</span> svtUnknown;
00214 } <span class="comment">// GetShaderVarType</span>
00215 
00216 <span class="preprocessor">#endif // __D3DShaderFX_H__</span>
</pre></div><hr><address style="align: right;"><small>
Generated on Tue Jun 13 11:14:33 2006 for gRenderDX9 by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.1 using KingsTools</small></address>
</body>
</html>
