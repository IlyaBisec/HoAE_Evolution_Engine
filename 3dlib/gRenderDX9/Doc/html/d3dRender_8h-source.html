<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>gRenderDX9: d3dRender.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<h1>d3dRender.h</h1><div class="fragment"><pre>00001 <span class="comment">/*****************************************************************************/</span>
00002 <span class="comment">/*  File:   d3dRender.h</span>
00003 <span class="comment">/*  Desc:   Render system interface implementation for DirectX9 </span>
00004 <span class="comment">/*  Author: Ruslan Shestopalyuk</span>
00005 <span class="comment">/*  Date:   02.11.2004</span>
00006 <span class="comment">/*****************************************************************************/</span>
00007 <span class="preprocessor">#ifndef __D3DRENDER_H__</span>
00008 <span class="preprocessor"></span><span class="preprocessor">#define __D3DRENDER_H__</span>
00009 <span class="preprocessor"></span>
00010 <span class="preprocessor">#include &lt;stack&gt;</span>
00011 <span class="preprocessor">#include "kStaticArray.hpp"</span>
00012 
00013 <span class="comment">/*****************************************************************************/</span>
00014 <span class="comment">/*  Struct: VertexTypeEntry</span>
00015 <span class="comment">/*  Desc:   Helper structure for caching vertex description</span>
00016 <span class="comment">/*****************************************************************************/</span>
00017 <span class="keyword">struct </span>VertexTypeEntry
00018 {
00019     VertexFormat                    m_VFormat;      <span class="comment">//  vertex format</span>
00020     VertexDeclaration               m_VDecl;        <span class="comment">//  vertex declaration</span>
00021     DWORD                           m_FVF;          <span class="comment">//  FVF code</span>
00022     IDirect3DVertexDeclaration9*    m_pVDeclD3D;    <span class="comment">//  D3D declaration object</span>
00023 
00024     VertexTypeEntry() : m_VFormat(vfUnknown), m_FVF(0), m_pVDeclD3D(NULL) {}
00025 }; <span class="comment">// struct VertexTypeEntry</span>
00026 
00027 <span class="keyword">const</span> <span class="keywordtype">int</span> c_DynVBufferBytes     = 65535 * 64;
00028 <span class="keyword">const</span> <span class="keywordtype">int</span> c_StaticVBufferBytes  = 1024*1024*16;
00029 <span class="keyword">const</span> <span class="keywordtype">int</span> c_DynIBufferBytes     = 65535 * 8;
00030 <span class="keyword">const</span> <span class="keywordtype">int</span> c_StaticIBufferBytes  = 1024*1024*8;
00031 <span class="keyword">const</span> <span class="keywordtype">int</span> c_QuadIBufferBytes    = 65535 * 8;
00032 <span class="keyword">const</span> <span class="keywordtype">int</span> c_MaxRenderTasks       = 16384;
00033 
00034 <span class="keyword">typedef</span> static_array&lt;RenderTask*, c_MaxRenderTasks&gt; SortedTasks;
00035 <span class="comment">/*****************************************************************</span>
00036 <span class="comment">/*  Class:  RenderSystemDX9</span>
00037 <span class="comment">/*  Desc:   Implementation of the render system for DirectX9 </span>
00038 <span class="comment">/*****************************************************************/</span>
00039 <span class="keyword">class </span>RenderSystemDX9 : <span class="keyword">public</span> D3DApplication, <span class="keyword">public</span> IRenderSystem
00040 {
00041     <span class="keywordtype">bool</span>                            m_bInited;
00042     Matrix4D                        m_ViewTM; 
00043     Matrix4D                        m_ProjTM; 
00044     Matrix4D                        m_WorldTM; 
00045     Matrix4D                        m_WorldViewProjTM;
00046     Matrix4D                        m_TextureTM [c_MaxTextureStages];
00047     Matrix3D                        m_BumpTM    [c_MaxTextureStages]; 
00048     DWORD                           m_CurrentFrame;
00049     DWORD                           m_TextureOverride[8];
00050     DWORD                           m_ColorConst;
00051     <span class="keywordtype">int</span>                             m_ShadersQuality;
00052     
00053     Rct                             m_ViewPort;         <span class="comment">//  current viewport extents</span>
00054     <span class="keywordtype">float</span>                           m_ViewPortZNear;    <span class="comment">//  current viewport near clip plane</span>
00055     <span class="keywordtype">float</span>                           m_ViewPortZFar;     <span class="comment">//  current viewport far clip plane</span>
00056     <span class="keywordtype">bool</span>                            m_WTM_is1;          <span class="comment">//  WorldTM is 1</span>
00057     
00058     <span class="comment">//fog state</span>
00059     <span class="keywordtype">float</span>                           m_FogDensity; 
00060     DWORD                           m_FogColor;
00061     <span class="keywordtype">float</span>                           m_FogStart;
00062     <span class="keywordtype">float</span>                           m_FogEnd;
00063     <span class="keywordtype">float</span>                           m_FogMode;
00064 
00065 
00066     std::vector&lt;IShader*&gt;           m_Shaders;          <span class="comment">//  shader registry</span>
00067     std::vector&lt;int&gt;                m_LowShaderID;      <span class="comment">//  low quality shader index -1 means no lq shader</span>
00068     std::vector&lt;IFont*&gt;             m_Fonts;            <span class="comment">//  fonts registry</span>
00069 
00070     std::vector&lt;TextureDX9*&gt;        m_Textures;     <span class="comment">//  texture registry</span>
00071     std::vector&lt;VertexBufferDX9*&gt;   m_VBuffers;     <span class="comment">//  vertex buffer registry</span>
00072     std::vector&lt;IndexBufferDX9*&gt;    m_IBuffers;     <span class="comment">//  index buffer registry</span>
00073     std::vector&lt;IDeviceClient*&gt;     m_DeviceClients;<span class="comment">//  registry of device-dependent entities</span>
00074 
00075     std::vector&lt;VertexTypeEntry&gt;    m_VertexTypes;  <span class="comment">//  cached stock vertex type descriptions</span>
00076 
00077     std::vector&lt;D3DDISPLAYMODE&gt;     m_BestDisplayModes;
00078 
00079     <span class="keywordtype">int</span>                             m_CurShader;        <span class="comment">//  index of the currently active shader</span>
00080     <span class="keywordtype">int</span>                             m_CurPass;          <span class="comment">//  current shader pass</span>
00081     <span class="keywordtype">int</span>                             m_CurTex[c_MaxTextureStages];
00082     <span class="keywordtype">float</span>                           m_FPS;
00083 
00084     <span class="keyword">struct </span>RenderTargetPair
00085     {
00086         <span class="keywordtype">int</span>     m_Color;
00087         <span class="keywordtype">int</span>     m_DepthStencil;
00088 
00089         RenderTargetPair( <span class="keywordtype">int</span> clr, <span class="keywordtype">int</span> depth ) : m_Color(clr), m_DepthStencil(depth) {}
00090     };
00091 
00092     std::stack&lt;RenderTargetPair&gt;    m_RTStack;
00093 
00094     IDirect3DSurface9*              m_pBackBufferSurface;
00095     IDirect3DSurface9*              m_pDepthStencilSurface;
00096 
00097 <span class="keyword">public</span>:
00098                             RenderSystemDX9 ();
00099                             ~RenderSystemDX9();
00100     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            Init            ( HINSTANCE hInst, HWND hWnd = NULL );
00101     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            ShutDown        ();
00102     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SetScreenProp   ( <span class="keyword">const</span> ScreenProp&amp; prop );
00103     <span class="keyword">virtual</span> ScreenProp      GetScreenProp   ();
00104     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetNDisplayModes();
00105     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            GetDisplayMode  ( <span class="keywordtype">int</span> idx, <span class="keywordtype">int</span>&amp; width, <span class="keywordtype">int</span>&amp; height );
00106     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            GetClientSize   ( <span class="keywordtype">int</span>&amp; width, <span class="keywordtype">int</span>&amp; height );
00107     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            AddClient       ( IDeviceClient* iNotify );
00108     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            ClearDevice     ( DWORD color, <span class="keywordtype">bool</span> bColor = <span class="keyword">true</span>, <span class="keywordtype">bool</span> bDepth = <span class="keyword">true</span>, <span class="keywordtype">bool</span> bStencil = <span class="keyword">true</span> ) ;
00109     <span class="keyword">virtual</span> DWORD           GetCurFrame     ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_CurrentFrame; }
00110     <span class="keyword">virtual</span> <span class="keywordtype">float</span>           GetFPS          ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_FPS; } 
00111 
00112     <span class="comment">//  transforms</span>
00113     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetViewTM       ( <span class="keyword">const</span> Matrix4D&amp; vmatr );
00114     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetProjTM       ( <span class="keyword">const</span> Matrix4D&amp; pmatr );
00115     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetWorldTM      ( <span class="keyword">const</span> Matrix4D&amp; wmatr );
00116     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetWorldViewProjTM  ( <span class="keyword">const</span> Matrix4D&amp; wmatr );
00117     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            ResetWorldTM    ();
00118     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetTextureTM    ( <span class="keyword">const</span> Matrix4D&amp; tmatr, <span class="keywordtype">int</span> stage = 0 );
00119     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetBumpTM       ( <span class="keyword">const</span> Matrix3D&amp; bmatr, <span class="keywordtype">int</span> stage = 0 );
00120     <span class="keyword">virtual</span> <span class="keyword">const</span> Matrix4D&amp; GetViewTM       ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_ViewTM; }
00121     <span class="keyword">virtual</span> <span class="keyword">const</span> Matrix4D&amp; GetProjTM       ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_ProjTM; }
00122     <span class="keyword">virtual</span> <span class="keyword">const</span> Matrix4D&amp; GetWorldTM      ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_WorldTM; }
00123     <span class="keyword">virtual</span> <span class="keyword">const</span> Matrix4D&amp; GetWorldViewProjTM()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_WorldViewProjTM; }
00124     <span class="keyword">virtual</span> <span class="keyword">const</span> Matrix4D&amp; GetTextureTM    ( <span class="keywordtype">int</span> stage = 0 )<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_TextureTM[stage]; }  
00125     <span class="keyword">virtual</span> <span class="keyword">const</span> Matrix3D&amp; GetBumpTM       ( <span class="keywordtype">int</span> stage = 0 )<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_BumpTM[stage]; }
00126 
00127     <span class="comment">//  cursor</span>
00128     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SetCursor       ( <span class="keywordtype">int</span> texID, <span class="keyword">const</span> Rct&amp; rctOnTex, <span class="keywordtype">int</span> hotspotX, <span class="keywordtype">int</span> hotspotY );
00129     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            UpdateCursor    ( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">bool</span> drawNow = <span class="keyword">false</span> );
00130     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            ShowCursor      ( <span class="keywordtype">bool</span> bShow = <span class="keyword">true</span> );
00131 
00132     <span class="comment">//  vertex buffers</span>
00133     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             RegisterVType   ( <span class="keyword">const</span> VertexDeclaration&amp; vdecl );
00134     <span class="keyword">virtual</span> BYTE*           LockVB          ( <span class="keywordtype">int</span> vbID, <span class="keywordtype">int</span> firstV, <span class="keywordtype">int</span> numV, DWORD&amp; stamp );
00135     <span class="keyword">virtual</span> BYTE*           LockAppendVB    ( <span class="keywordtype">int</span> vbID, <span class="keywordtype">int</span> size, <span class="keywordtype">int</span>&amp; offset, DWORD&amp; stamp );
00136     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            UnlockVB        ( <span class="keywordtype">int</span> vbID );
00137     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetVBufferID    ( <span class="keyword">const</span> <span class="keywordtype">char</span>* vbName );
00138     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            DiscardVB       ( <span class="keywordtype">int</span> vbID );
00139     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             CreateVB        ( <span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keywordtype">int</span> size, <span class="keywordtype">int</span> vType, <span class="keywordtype">bool</span> bDynamic = <span class="keyword">false</span> );
00140     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            DeleteVB        ( <span class="keywordtype">int</span> vbID );
00141     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SetVB           ( <span class="keywordtype">int</span> vbID,  <span class="keywordtype">int</span> vType = -1, <span class="keywordtype">int</span> stream = 0, <span class="keywordtype">int</span> frequency = 1 );
00142     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            IsVBStampValid  ( <span class="keywordtype">int</span> vbID, DWORD stamp );
00143 
00144     <span class="comment">//  index buffers</span>
00145     <span class="keyword">virtual</span> BYTE*           LockIB          ( <span class="keywordtype">int</span> ibID, <span class="keywordtype">int</span> firstIdx, <span class="keywordtype">int</span> numIdx, DWORD&amp; stamp );
00146     <span class="keyword">virtual</span> BYTE*           LockAppendIB    ( <span class="keywordtype">int</span> ibID, <span class="keywordtype">int</span> size, <span class="keywordtype">int</span>&amp; offset, DWORD&amp; stamp );
00147     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            UnlockIB        ( <span class="keywordtype">int</span> ibID );
00148     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            IsIBStampValid  ( <span class="keywordtype">int</span> ibID, DWORD stamp ); 
00149     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetIBufferID    ( <span class="keyword">const</span> <span class="keywordtype">char</span>* ibName );
00150     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            DiscardIB       ( <span class="keywordtype">int</span> ibID );
00151     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             CreateIB        ( <span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keywordtype">int</span> size, IndexSize idxSize, <span class="keywordtype">bool</span> bDynamic = <span class="keyword">false</span> );
00152     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            DeleteIB        ( <span class="keywordtype">int</span> ibID );
00153     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SetIB           ( <span class="keywordtype">int</span> ibID );
00154 
00155     <span class="comment">//  drawing</span>
00156     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            StartFrame      ();
00157     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            EndFrame        ();
00158     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            Draw            ( <span class="keywordtype">int</span> firstVert, <span class="keywordtype">int</span> nVert, <span class="keywordtype">int</span> firstIdx, <span class="keywordtype">int</span> nIdx, 
00159                                                 PrimitiveType priType = ptTriangleList );
00160 
00161     <span class="keyword">virtual</span> <span class="keywordtype">float</span>           GetFogDensity   ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_FogDensity; }
00162     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetFogDensity   ( <span class="keywordtype">float</span> fog ) { m_FogDensity = fog; }
00163 
00164     <span class="comment">//  textures</span>
00165     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            ReloadTextures  ();
00166     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetTextureOverride  ( <span class="keywordtype">int</span> TextureID,<span class="keywordtype">int</span> Stage );
00167     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetTextureOverride  ( <span class="keywordtype">int</span> Stage );
00168     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetTransparentTexOverride( <span class="keywordtype">int</span> Stage );
00169     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetTexture      ( <span class="keywordtype">int</span> texID, <span class="keywordtype">int</span> stage = 0, <span class="keywordtype">bool</span> bCache = <span class="keyword">false</span> );
00170     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetTexture      ( <span class="keywordtype">int</span> stage = 0 );
00171     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetShader       () { <span class="keywordflow">return</span> m_CurShader; }
00172     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SaveTexture     ( <span class="keywordtype">int</span> texID, <span class="keyword">const</span> <span class="keywordtype">char</span>* fname );
00173     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            CopyTexture     ( <span class="keywordtype">int</span> destID, <span class="keywordtype">int</span> srcID, <span class="keyword">const</span> Rct* rct = NULL, <span class="keywordtype">int</span> nRect = 1 ); 
00174     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            CreateMipLevels ( <span class="keywordtype">int</span> texID );
00175     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetTextureID    ( <span class="keyword">const</span> <span class="keywordtype">char</span>* texName );
00176     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             CreateNormalMap ( <span class="keywordtype">int</span> texID, <span class="keywordtype">float</span> amplitude = 10.0f );
00177     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            DeleteTexture   ( <span class="keywordtype">int</span> texID );
00178     <span class="keyword">virtual</span> BYTE*           LockTexBits     ( <span class="keywordtype">int</span> texID, <span class="keywordtype">int</span>&amp; pitch, <span class="keywordtype">int</span> level = 0 );
00179     BYTE*                   LockTexBits     ( <span class="keywordtype">int</span> texID, <span class="keyword">const</span> Rct&amp; rect, <span class="keywordtype">int</span>&amp; pitch, <span class="keywordtype">int</span> level = 0 );
00180     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            UnlockTexBits   ( <span class="keywordtype">int</span> texID, <span class="keywordtype">int</span> level = 0 );
00181     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetTexMemorySize() <span class="keyword">const</span>;
00182     
00183     <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>*     GetTextureName  ( <span class="keywordtype">int</span> texID );
00184     <span class="keyword">virtual</span> ColorFormat     GetTextureFormat( <span class="keywordtype">int</span> texID );
00185     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetNTextures    () <span class="keyword">const</span>;
00186     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetTextureSize  ( <span class="keywordtype">int</span> texID ) <span class="keyword">const</span>;
00187     <span class="keyword">virtual</span> TextureMemoryPool GetTexturePool( <span class="keywordtype">int</span> texID ) <span class="keyword">const</span>;
00188     
00189     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetTextureWidth ( <span class="keywordtype">int</span> texID ) <span class="keyword">const</span>;
00190     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetTextureHeight( <span class="keywordtype">int</span> texID ) <span class="keyword">const</span>;
00191     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetTextureNMips ( <span class="keywordtype">int</span> texID ) <span class="keyword">const</span>;
00192 
00193     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             CreateTexture   ( <span class="keyword">const</span> <span class="keywordtype">char</span>* texName, 
00194                                                 <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height, 
00195                                                 ColorFormat clrFormat, 
00196                                                 <span class="keywordtype">int</span> nMips = 0, 
00197                                                 TextureMemoryPool memPool = tmpManaged, 
00198                                                 <span class="keywordtype">bool</span> bRenderTarget = <span class="keyword">false</span>, 
00199                                                 DepthStencilFormat dsFormat = dsfNone,
00200                                                 <span class="keywordtype">bool</span> bDynamic = <span class="keyword">false</span> );
00201 
00202     <span class="comment">//  shaders</span>
00203     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetShaderID     ( <span class="keyword">const</span> <span class="keywordtype">char</span>* shaderName );
00204     <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>*     GetShaderName   ( <span class="keywordtype">int</span> shID ) <span class="keyword">const</span>;
00205     <span class="keyword">virtual</span> IShader*        GetShader       ( <span class="keywordtype">int</span> shID ) <span class="keyword">const</span>;
00206     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetNShaderVars  ( <span class="keywordtype">int</span> shID ) <span class="keyword">const</span>;
00207     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetNShaderPasses( <span class="keywordtype">int</span> shID ) <span class="keyword">const</span>;
00208     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetShaderVarID  ( <span class="keywordtype">int</span> shID, <span class="keyword">const</span> <span class="keywordtype">char</span>* constantName );
00209     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SetShaderTech   ( <span class="keywordtype">int</span> shID, <span class="keywordtype">int</span> techID );
00210     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SetShaderVar    ( <span class="keywordtype">int</span> shID, <span class="keywordtype">int</span> cID, <span class="keywordtype">bool</span> val );
00211     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SetShaderVar    ( <span class="keywordtype">int</span> shID, <span class="keywordtype">int</span> cID, <span class="keywordtype">float</span> val );
00212     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SetShaderVar    ( <span class="keywordtype">int</span> shID, <span class="keywordtype">int</span> cID, <span class="keywordtype">int</span> val );
00213     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SetShaderVar    ( <span class="keywordtype">int</span> shID, <span class="keywordtype">int</span> cID, <span class="keyword">const</span> Matrix4D&amp; val );
00214     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SetShaderVar    ( <span class="keywordtype">int</span> shID, <span class="keywordtype">int</span> cID, <span class="keyword">const</span> Vector4D&amp; val );
00215     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SetShaderVar    ( <span class="keywordtype">int</span> shID, <span class="keywordtype">int</span> cID, <span class="keyword">const</span> Vector3D&amp; val );
00216     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            ReloadShaders   ();
00217     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetShader       ( <span class="keywordtype">int</span> shaderID, <span class="keywordtype">int</span> passID = 0 );
00218     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetShaderAutoVars();
00219     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            IsShaderValid   ( <span class="keywordtype">int</span> shID, <span class="keywordtype">int</span> techID = 0 );
00220     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetShadersQuality( <span class="keywordtype">int</span> Level );
00221     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetShadersQuality();
00222 
00223     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            SetClipPlane    ( DWORD idx, <span class="keyword">const</span> Plane&amp; plane );
00224     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            PushRenderTarget( <span class="keywordtype">int</span> texID, <span class="keywordtype">int</span> dsID = -1 );
00225     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            PopRenderTarget ();
00226     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetViewPort     ( <span class="keyword">const</span> Rct&amp; vp, <span class="keywordtype">float</span> zn = 0.0f, <span class="keywordtype">float</span> zf = 1.0f, <span class="keywordtype">bool</span> bClip = <span class="keyword">true</span> );
00227     <span class="keyword">virtual</span> Rct             GetViewPort     ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_ViewPort; }
00228     
00229     <span class="keyword">virtual</span> DWORD           GetTextureFactor()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_TFactor; }
00230     <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>*     GetTexturePath  ( <span class="keywordtype">int</span> texID ) <span class="keyword">const</span>;
00231     <span class="comment">//  direct render states changing </span>
00232     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetTextureFactor( DWORD tfactor       );
00233     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetAlphaRef     ( BYTE alphaRef       );
00234     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetZEnable      ( <span class="keywordtype">bool</span> bEnable = <span class="keyword">true</span> );
00235     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetZWriteEnable ( <span class="keywordtype">bool</span> bEnable = <span class="keyword">true</span> );
00236     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetDitherEnable ( <span class="keywordtype">bool</span> bEnable = <span class="keyword">true</span> );
00237     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetWireframe    ( <span class="keywordtype">bool</span> bEnable = <span class="keyword">true</span> );
00238     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetTexFilterEnable( <span class="keywordtype">bool</span> bEnable = <span class="keyword">true</span> ); 
00239     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetColorConst   ( DWORD Color );
00240     <span class="keyword">virtual</span> DWORD           GetColorConst   ();
00241 
00242     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            Dump            ( <span class="keyword">const</span> <span class="keywordtype">char</span>* fname = 0 );
00243     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            ApplyStateBlock ( DWORD id );
00244     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            DeleteStateBlock( DWORD id );   
00245     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetRSBlock      ( RenderStateBlock* pBlock             );
00246     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetTSBlock      ( TextureStateBlock* pBlock, <span class="keywordtype">int</span> stage );
00247     <span class="keyword">virtual</span> DWORD           CreateStateBlock( StateBlock*        pBlock            );
00248 
00249     <span class="comment">//  lighting</span>
00250     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetDirLight     ( DirectionalLight* pLight, <span class="keywordtype">int</span>&amp; index );
00251     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetPointLight   ( PointLight*       pLight, <span class="keywordtype">int</span>&amp; index );
00252     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetSpotLight    ( SpotLight*        pLight, <span class="keywordtype">int</span>&amp; index );
00253     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetFog( DWORD FogColor,<span class="keywordtype">float</span> FogStart,<span class="keywordtype">float</span> FogEnd,<span class="keywordtype">float</span> FogDensity,<span class="keywordtype">int</span> FogMode );
00254     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            ApplyFogStateBlock  ();
00255     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            DisableLights   ();
00256     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetMaterial     ( DWORD ambient, DWORD diffuse, DWORD specular, DWORD emissive, <span class="keywordtype">float</span> power );
00257 
00258     <span class="comment">//  font</span>
00259     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetFontID       ( <span class="keyword">const</span> <span class="keywordtype">char</span>* name );
00260     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            DestroyFont     ( <span class="keywordtype">int</span> fontID );
00261     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             CreateFont      ( <span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keywordtype">int</span> height, DWORD charset = DEFAULT_CHARSET, <span class="keywordtype">bool</span> bBold = <span class="keyword">false</span>, <span class="keywordtype">bool</span> bItalic = <span class="keyword">false</span> );
00262     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             CreateFont      ( <span class="keyword">const</span> <span class="keywordtype">char</span>* texName, <span class="keywordtype">int</span> charW, <span class="keywordtype">int</span> charH );
00263     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetStringWidth  ( <span class="keywordtype">int</span> fontID, <span class="keyword">const</span> <span class="keywordtype">char</span>* str, <span class="keywordtype">int</span> spacing = 1 );
00264     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetCharWidth    ( <span class="keywordtype">int</span> fontID, BYTE ch );
00265     <span class="keyword">virtual</span> <span class="keywordtype">int</span>             GetCharHeight   ( <span class="keywordtype">int</span> fontID, BYTE ch );
00266     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            SetCurrentFont  ( <span class="keywordtype">int</span> fontID );
00267 
00268     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            DrawString      ( <span class="keyword">const</span> <span class="keywordtype">char</span>* str, <span class="keyword">const</span> Vector3D&amp; pos, DWORD colorxFFFFFFFF, <span class="keywordtype">int</span> spacing = 1 );
00269     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            DrawString3D    ( <span class="keyword">const</span> <span class="keywordtype">char</span>* str, <span class="keyword">const</span> Vector3D&amp; pos, DWORD colorxFFFFFFFF, <span class="keywordtype">int</span> spacing = 1 );
00270     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            DrawChar        ( <span class="keyword">const</span> Vector3D&amp; pos, BYTE ch, DWORD colorxFFFFFFFF );
00271     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            DrawChar        ( <span class="keyword">const</span> Vector3D&amp; pos, <span class="keyword">const</span> Rct&amp; uv, DWORD colorxFFFFFFFF );
00272     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            DrawChar        ( <span class="keyword">const</span> Vector3D&amp; pos, <span class="keyword">const</span> Rct&amp; uv, <span class="keywordtype">float</span> w, <span class="keywordtype">float</span> h, DWORD colorxFFFFFFFF );
00273     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            FlushText       (); 
00274 
00275     <span class="comment">//  primitives</span>
00276     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            DrawLine        ( <span class="keywordtype">float</span> x1, <span class="keywordtype">float</span> y1, <span class="keywordtype">float</span> x2, <span class="keywordtype">float</span> y2, <span class="keywordtype">float</span> z, DWORD color1, DWORD color2 );
00277     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            DrawLine        ( <span class="keyword">const</span> Vector3D&amp; a, <span class="keyword">const</span> Vector3D&amp; b, DWORD color1, DWORD color2 );
00278     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            DrawRect        ( <span class="keyword">const</span> Rct&amp; rct, <span class="keyword">const</span> Rct&amp; uv, <span class="keywordtype">float</span> z, DWORD ca, DWORD cb, DWORD cc, DWORD cd );
00279     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            DrawPoly        ( <span class="keywordtype">float</span> ax, <span class="keywordtype">float</span> ay, <span class="keywordtype">float</span> bx, <span class="keywordtype">float</span> by, <span class="keywordtype">float</span> cx, <span class="keywordtype">float</span> cy,
00280                                                 <span class="keywordtype">float</span> au, <span class="keywordtype">float</span> av, <span class="keywordtype">float</span> bu, <span class="keywordtype">float</span> bv, <span class="keywordtype">float</span> cu, <span class="keywordtype">float</span> cv );
00281     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            DrawPoly        ( <span class="keyword">const</span> Vector3D&amp; a, <span class="keyword">const</span> Vector3D&amp; b, <span class="keyword">const</span> Vector3D&amp; c, DWORD acol, DWORD bcol, DWORD ccol,
00282                                                 <span class="keywordtype">float</span> au, <span class="keywordtype">float</span> av, <span class="keywordtype">float</span> bu, <span class="keywordtype">float</span> bv, <span class="keywordtype">float</span> cu, <span class="keywordtype">float</span> cv );
00283     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            FlushPrim       ( <span class="keywordtype">bool</span> bShaded = <span class="keyword">true</span> );
00284     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            PurgeStaticBuffers ();
00285 
00286     <span class="keyword">virtual</span> RenderTask&amp;     AddTask         ();
00287     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            Flush           ();
00288 
00289     <span class="comment">//  internal methods for Direct3D-aware clients</span>
00290     IDirect3DDevice9*       GetDevice       () { <span class="keywordflow">return</span> m_pDevice; }
00291     IDirect3DSurface9*      GetSurface      ( <span class="keywordtype">int</span> texID );
00292 
00293     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            ScreenShotBMP       (<span class="keyword">const</span> <span class="keywordtype">char</span> *pBMPFileName);
00294     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            ScreenShotJPG       (<span class="keyword">const</span> <span class="keywordtype">char</span> *pJPGFileName);
00295 
00296     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            TimeOverrideEnable      (<span class="keyword">const</span> <span class="keywordtype">float</span> secNewTime);
00297     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            TimeOverrideDisable     ();
00298     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            TimeOverrideIsEnabled   (<span class="keywordtype">float</span> *pSecTime = NULL);
00299 
00300     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            AntialiasingEnable      ();
00301     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            AntialiasingDisable     ();
00302     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            AntialiasingIsEnabled   ();
00303 
00304     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            TrueColorEnable         ();
00305     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            TrueColorDisable        ();
00306     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            TrueColorIsEnabled      ();
00307 
00308     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            GetDeviceDisplayMode    (<span class="keywordtype">int</span> *pWidth, <span class="keywordtype">int</span> *pHeight, <span class="keywordtype">int</span> *pBpp, <span class="keywordtype">int</span> *pRefrehsRate);
00309 
00310     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            RefreshRateOverrideEnable(<span class="keyword">const</span> <span class="keywordtype">int</span> Hz);
00311     <span class="keyword">virtual</span> <span class="keywordtype">void</span>            RefreshRateOverrideDisable();
00312     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            RefreshRateOverrideIsEnabled(<span class="keywordtype">int</span> *pHz = NULL);
00313 
00314 <span class="keyword">protected</span>:
00315     <span class="keywordtype">void</span>                    ScreenShot(<span class="keyword">const</span> <span class="keywordtype">char</span> *pFileName, _D3DXIMAGE_FILEFORMAT Format);
00316 
00317 
00318     <span class="keywordtype">bool</span>                SetMonitorResolution    ();
00319     <span class="keywordtype">void</span>                CreateVTypeTable        ();
00320     <span class="keywordtype">void</span>                ClearVTypeTable         ();
00321     HRESULT             OneTimeSceneInit        ();
00322     HRESULT             InitDeviceObjects       ();
00323     HRESULT             RestoreDeviceObjects    ();
00324     HRESULT             InvalidateDeviceObjects ();
00325     HRESULT             DeleteDeviceObjects     ();
00326     HRESULT             FinalCleanup            ();
00327     HRESULT             ConfirmDevice           ( D3DCAPS9* pCaps, DWORD dwBehavior, 
00328                                                     D3DFORMAT adapterFormat, D3DFORMAT backBufferFormat );
00329 
00330     <span class="keywordtype">void</span>                FillQuadIndexBuffer     ();
00331     <span class="keyword">virtual</span> LRESULT     MsgProc                 ( HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam );    
00332 
00333     RenderTask           m_Tasks[c_MaxRenderTasks];
00334     SortedTasks         m_SortedTasks;
00335     <span class="keywordtype">int</span>                 m_NTasks;
00336     <span class="keywordtype">bool</span>                m_bSorted;
00337 
00338     DWORD               m_TFactor;
00339     <span class="keywordtype">void</span>                SortTasks();
00340 
00341     <span class="keywordtype">bool</span> m_TimeIsOverridden;
00342     <span class="keywordtype">float</span> m_secOverriddenTime;
00343 
00344     <span class="keywordtype">bool</span> m_RefreshRateIsOverridden;
00345     <span class="keywordtype">int</span> m_HzOverriddenRefreshRate;
00346     <span class="keywordtype">int</span> m_HzDefaultRefreshRate;
00347 }; <span class="comment">// class RenderSystemDX9</span>
00348 
00349 IDirect3DDevice9* GetDirect3DDevice();
00350 IDirect3DSurface9* GetDirect3DSurface( <span class="keywordtype">int</span> texID );
00351 
00352 
00353 
00354 <span class="preprocessor">#endif // __D3DRENDER_H__</span>
00355 <span class="preprocessor"></span>
00356 
</pre></div><hr><address style="align: right;"><small>
Generated on Tue Jun 13 11:14:33 2006 for gRenderDX9 by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.1 using KingsTools</small></address>
</body>
</html>
