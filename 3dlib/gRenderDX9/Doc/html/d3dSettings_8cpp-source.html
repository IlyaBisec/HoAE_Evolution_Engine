<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>gRenderDX9: d3dSettings.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<h1>d3dSettings.cpp</h1><div class="fragment"><pre>00001 <span class="comment">//-----------------------------------------------------------------------------</span>
00002 <span class="comment">// File: D3DSettings.cpp</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// Desc: Settings class and change-settings dialog class for the Direct3D </span>
00005 <span class="comment">//       samples framework library.</span>
00006 <span class="comment">//</span>
00007 <span class="comment">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
00008 <span class="comment">//-----------------------------------------------------------------------------</span>
00009 <span class="preprocessor">#include "gRenderPch.h"</span>
00010 
00011 CD3DSettingsDialog* s_pSettingsDialog = NULL;
00012 
00013 
00014 <span class="comment">//-----------------------------------------------------------------------------</span>
00015 <span class="comment">// Name: D3DDevTypeToString</span>
00016 <span class="comment">// Desc: Returns the string for the given D3DDEVTYPE.</span>
00017 <span class="comment">//-----------------------------------------------------------------------------</span>
00018 TCHAR* D3DDevTypeToString(D3DDEVTYPE devType)
00019 {
00020     <span class="keywordflow">switch</span> (devType)
00021     {
00022     <span class="keywordflow">case</span> D3DDEVTYPE_HAL:        <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DDEVTYPE_HAL"</span>);
00023     <span class="keywordflow">case</span> D3DDEVTYPE_SW:         <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DDEVTYPE_SW"</span>);
00024     <span class="keywordflow">case</span> D3DDEVTYPE_REF:        <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DDEVTYPE_REF"</span>);
00025     <span class="keywordflow">default</span>:                    <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"Unknown devType"</span>);
00026     }
00027 }
00028 
00029 
00030 <span class="comment">//-----------------------------------------------------------------------------</span>
00031 <span class="comment">// Name: MultisampleTypeToString</span>
00032 <span class="comment">// Desc: Returns the string for the given D3DMULTISAMPLE_TYPE.</span>
00033 <span class="comment">//-----------------------------------------------------------------------------</span>
00034 TCHAR* MultisampleTypeToString(D3DMULTISAMPLE_TYPE MultiSampleType)
00035 {
00036     <span class="keywordflow">switch</span> (MultiSampleType)
00037     {
00038         <span class="keywordflow">case</span> D3DMULTISAMPLE_NONE:           <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_NONE"</span>);
00039         <span class="keywordflow">case</span> D3DMULTISAMPLE_NONMASKABLE:    <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_NONMASKABLE"</span>);
00040         <span class="keywordflow">case</span> D3DMULTISAMPLE_2_SAMPLES:      <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_2_SAMPLES"</span>);
00041         <span class="keywordflow">case</span> D3DMULTISAMPLE_3_SAMPLES:      <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_3_SAMPLES"</span>);
00042         <span class="keywordflow">case</span> D3DMULTISAMPLE_4_SAMPLES:      <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_4_SAMPLES"</span>);
00043         <span class="keywordflow">case</span> D3DMULTISAMPLE_5_SAMPLES:      <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_5_SAMPLES"</span>);
00044         <span class="keywordflow">case</span> D3DMULTISAMPLE_6_SAMPLES:      <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_6_SAMPLES"</span>);
00045         <span class="keywordflow">case</span> D3DMULTISAMPLE_7_SAMPLES:      <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_7_SAMPLES"</span>);
00046         <span class="keywordflow">case</span> D3DMULTISAMPLE_8_SAMPLES:      <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_8_SAMPLES"</span>);
00047         <span class="keywordflow">case</span> D3DMULTISAMPLE_9_SAMPLES:      <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_9_SAMPLES"</span>);
00048         <span class="keywordflow">case</span> D3DMULTISAMPLE_10_SAMPLES:     <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_10_SAMPLES"</span>);
00049         <span class="keywordflow">case</span> D3DMULTISAMPLE_11_SAMPLES:     <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_11_SAMPLES"</span>);
00050         <span class="keywordflow">case</span> D3DMULTISAMPLE_12_SAMPLES:     <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_12_SAMPLES"</span>);
00051         <span class="keywordflow">case</span> D3DMULTISAMPLE_13_SAMPLES:     <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_13_SAMPLES"</span>);
00052         <span class="keywordflow">case</span> D3DMULTISAMPLE_14_SAMPLES:     <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_14_SAMPLES"</span>);
00053         <span class="keywordflow">case</span> D3DMULTISAMPLE_15_SAMPLES:     <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_15_SAMPLES"</span>);
00054         <span class="keywordflow">case</span> D3DMULTISAMPLE_16_SAMPLES:     <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DMULTISAMPLE_16_SAMPLES"</span>);
00055         <span class="keywordflow">default</span>:                            <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"Unknown Multisample Type"</span>);
00056     }
00057 } <span class="comment">// * MultisampleTypeToString</span>
00058 
00059 <span class="comment">//-----------------------------------------------------------------------------</span>
00060 <span class="comment">// Name: VertexProcessingTypeToString</span>
00061 <span class="comment">// Desc: Returns the string for the given VertexProcessingType.</span>
00062 <span class="comment">//-----------------------------------------------------------------------------</span>
00063 TCHAR* VertexProcessingTypeToString(VertexProcessingType vpt)
00064 {
00065     <span class="keywordflow">switch</span> (vpt)
00066     {
00067         <span class="keywordflow">case</span> vpSoftware:        <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"Software VP"</span>);
00068         <span class="keywordflow">case</span> vpMixed:           <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"Mixed VP"</span>);
00069         <span class="keywordflow">case</span> vpHardware:        <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"Hardware VP"</span>);
00070         <span class="keywordflow">case</span> vpPureHardware:    <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"Pure Hardware VP"</span>);
00071         <span class="keywordflow">default</span>:                <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"Unknown VP"</span>);
00072     }
00073 } <span class="comment">// VertexProcessingTypeToString</span>
00074 
00075 <span class="comment">//-----------------------------------------------------------------------------</span>
00076 <span class="comment">// Name: PresentIntervalToString</span>
00077 <span class="comment">// Desc: Returns the string for the given present interval.</span>
00078 <span class="comment">//-----------------------------------------------------------------------------</span>
00079 TCHAR* PresentIntervalToString( UINT pi )
00080 {
00081     <span class="keywordflow">switch</span>( pi )
00082     {
00083     <span class="keywordflow">case</span> D3DPRESENT_INTERVAL_IMMEDIATE: <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DPRESENT_INTERVAL_IMMEDIATE"</span>);
00084     <span class="keywordflow">case</span> D3DPRESENT_INTERVAL_DEFAULT:   <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DPRESENT_INTERVAL_DEFAULT"</span>);
00085     <span class="keywordflow">case</span> D3DPRESENT_INTERVAL_ONE:       <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DPRESENT_INTERVAL_ONE"</span>);
00086     <span class="keywordflow">case</span> D3DPRESENT_INTERVAL_TWO:       <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DPRESENT_INTERVAL_TWO"</span>);
00087     <span class="keywordflow">case</span> D3DPRESENT_INTERVAL_THREE:     <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DPRESENT_INTERVAL_THREE"</span>);
00088     <span class="keywordflow">case</span> D3DPRESENT_INTERVAL_FOUR:      <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"D3DPRESENT_INTERVAL_FOUR"</span>);
00089     <span class="keywordflow">default</span>:                            <span class="keywordflow">return</span> TEXT(<span class="stringliteral">"Unknown PresentInterval"</span>);
00090     }
00091 } <span class="comment">// PresentIntervalToString</span>
00092 
00093 <span class="comment">//-----------------------------------------------------------------------------</span>
00094 <span class="comment">// Name: DialogProcHelper</span>
00095 <span class="comment">// Desc: </span>
00096 <span class="comment">//-----------------------------------------------------------------------------</span>
00097 INT_PTR CALLBACK DialogProcHelper( HWND hDlg, UINT msg, WPARAM wParam, LPARAM lParam )
00098 {
00099     <span class="keywordflow">return</span> s_pSettingsDialog-&gt;DialogProc( hDlg, msg, wParam, lParam );
00100 }
00101 
00102 
00103 
00104 
00105 <span class="comment">//-----------------------------------------------------------------------------</span>
00106 <span class="comment">// Name: CD3DSettingsDialog constructor</span>
00107 <span class="comment">// Desc: </span>
00108 <span class="comment">//-----------------------------------------------------------------------------</span>
00109 CD3DSettingsDialog::CD3DSettingsDialog( D3DEnumeration* pEnumeration, 
00110                                         D3DSettings* pSettings)
00111 {
00112     s_pSettingsDialog = <span class="keyword">this</span>;
00113     m_pEnumeration = pEnumeration;
00114     m_d3dSettings = *pSettings;
00115 }
00116 
00117 
00118 
00119 
00120 <span class="comment">//-----------------------------------------------------------------------------</span>
00121 <span class="comment">// Name: ComboBoxAdd</span>
00122 <span class="comment">// Desc: Adds an entry to the combo box.</span>
00123 <span class="comment">//-----------------------------------------------------------------------------</span>
00124 <span class="keywordtype">void</span> CD3DSettingsDialog::ComboBoxAdd( <span class="keywordtype">int</span> id, <span class="keyword">const</span> <span class="keywordtype">void</span>* pData, LPCTSTR pstrDesc )
00125 {
00126     HWND hwndCtrl = GetDlgItem( m_hDlg, id );
00127     DWORD dwItem = ComboBox_AddString( hwndCtrl, pstrDesc );
00128     ComboBox_SetItemData( hwndCtrl, dwItem, pData );
00129 }
00130 
00131 <span class="comment">//-----------------------------------------------------------------------------</span>
00132 <span class="comment">// Name: ComboBoxSelect</span>
00133 <span class="comment">// Desc: Selects an entry in the combo box.</span>
00134 <span class="comment">//-----------------------------------------------------------------------------</span>
00135 <span class="keywordtype">void</span> CD3DSettingsDialog::ComboBoxSelect( <span class="keywordtype">int</span> id, <span class="keyword">const</span> <span class="keywordtype">void</span>* pData )
00136 {
00137     HWND hwndCtrl = GetDlgItem( m_hDlg, id );
00138     UINT count = ComboBoxCount( id );
00139     <span class="keywordflow">for</span>( UINT iItem = 0; iItem &lt; count; iItem++ )
00140     {
00141         <span class="keywordflow">if</span>( (<span class="keywordtype">void</span>*)ComboBox_GetItemData( hwndCtrl, iItem ) == pData )
00142         {
00143             ComboBox_SetCurSel( hwndCtrl, iItem );
00144             PostMessage( m_hDlg, WM_COMMAND, 
00145                 MAKEWPARAM( id, CBN_SELCHANGE ), (LPARAM)hwndCtrl );
00146             <span class="keywordflow">return</span>;
00147         }
00148     }
00149 }
00150 
00151 <span class="comment">//-----------------------------------------------------------------------------</span>
00152 <span class="comment">// Name: ComboBoxSelectIndex</span>
00153 <span class="comment">// Desc: Selects an entry in the combo box.</span>
00154 <span class="comment">//-----------------------------------------------------------------------------</span>
00155 <span class="keywordtype">void</span> CD3DSettingsDialog::ComboBoxSelectIndex( <span class="keywordtype">int</span> id, <span class="keywordtype">int</span> index )
00156 {
00157     HWND hwndCtrl = GetDlgItem( m_hDlg, id );
00158     ComboBox_SetCurSel( hwndCtrl, index );
00159     PostMessage( m_hDlg, WM_COMMAND, MAKEWPARAM( id, CBN_SELCHANGE ), 
00160         (LPARAM)hwndCtrl );
00161 }
00162 
00163 <span class="comment">//-----------------------------------------------------------------------------</span>
00164 <span class="comment">// Name: ComboBoxSelected</span>
00165 <span class="comment">// Desc: Returns the data for the selected entry in the combo box.</span>
00166 <span class="comment">//-----------------------------------------------------------------------------</span>
00167 <span class="keywordtype">void</span>* CD3DSettingsDialog::ComboBoxSelected( <span class="keywordtype">int</span> id )
00168 {
00169     HWND hwndCtrl = GetDlgItem( m_hDlg, id );
00170     <span class="keywordtype">int</span> index = ComboBox_GetCurSel( hwndCtrl );
00171     <span class="keywordflow">if</span>( index &lt; 0 )
00172         <span class="keywordflow">return</span> NULL;
00173     <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*)ComboBox_GetItemData( hwndCtrl, index );
00174 }
00175 
00176 
00177 
00178 
00179 <span class="comment">//-----------------------------------------------------------------------------</span>
00180 <span class="comment">// Name: ComboBoxSomethingSelected</span>
00181 <span class="comment">// Desc: Returns whether any entry in the combo box is selected.  This is </span>
00182 <span class="comment">//       more useful than ComboBoxSelected() when you need to distinguish </span>
00183 <span class="comment">//       between having no item selected vs. having an item selected whose </span>
00184 <span class="comment">//       itemData is NULL.</span>
00185 <span class="comment">//-----------------------------------------------------------------------------</span>
00186 <span class="keywordtype">bool</span> CD3DSettingsDialog::ComboBoxSomethingSelected( <span class="keywordtype">int</span> id )
00187 {
00188     HWND hwndCtrl = GetDlgItem( m_hDlg, id );
00189     <span class="keywordtype">int</span> index = ComboBox_GetCurSel( hwndCtrl );
00190     <span class="keywordflow">return</span> ( index &gt;= 0 );
00191 }
00192 
00193 
00194 
00195 
00196 <span class="comment">//-----------------------------------------------------------------------------</span>
00197 <span class="comment">// Name: ComboBoxCount</span>
00198 <span class="comment">// Desc: Returns the number of entries in the combo box.</span>
00199 <span class="comment">//-----------------------------------------------------------------------------</span>
00200 UINT CD3DSettingsDialog::ComboBoxCount( <span class="keywordtype">int</span> id )
00201 {
00202     HWND hwndCtrl = GetDlgItem( m_hDlg, id );
00203     <span class="keywordflow">return</span> ComboBox_GetCount( hwndCtrl );
00204 }
00205 
00206 
00207 
00208 
00209 <span class="comment">//-----------------------------------------------------------------------------</span>
00210 <span class="comment">// Name: ComboBoxClear</span>
00211 <span class="comment">// Desc: Clears the entries in the combo box.</span>
00212 <span class="comment">//-----------------------------------------------------------------------------</span>
00213 <span class="keywordtype">void</span> CD3DSettingsDialog::ComboBoxClear( <span class="keywordtype">int</span> id )
00214 {
00215     HWND hwndCtrl = GetDlgItem( m_hDlg, id );
00216     ComboBox_ResetContent( hwndCtrl );
00217 }
00218 
00219 
00220 
00221 
00222 <span class="comment">//-----------------------------------------------------------------------------</span>
00223 <span class="comment">// Name: ComboBoxContainsText</span>
00224 <span class="comment">// Desc: Returns whether the combo box contains the given text.</span>
00225 <span class="comment">//-----------------------------------------------------------------------------</span>
00226 <span class="keywordtype">bool</span> CD3DSettingsDialog::ComboBoxContainsText( <span class="keywordtype">int</span> id, LPCTSTR pstrText )
00227 {
00228     TCHAR strItem[200];
00229     HWND hwndCtrl = GetDlgItem( m_hDlg, id );
00230     UINT count = ComboBoxCount( id );
00231     <span class="keywordflow">for</span>( UINT iItem = 0; iItem &lt; count; iItem++ )
00232     {
00233         <span class="keywordflow">if</span>( ComboBox_GetLBTextLen( hwndCtrl, iItem ) &gt;= 200 )
00234             <span class="keywordflow">continue</span>; <span class="comment">// shouldn't happen, but don't overwrite buffer if it does</span>
00235         ComboBox_GetLBText( hwndCtrl, iItem, strItem );
00236         <span class="keywordflow">if</span>( lstrcmp( strItem, pstrText ) == 0 )
00237             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00238     }
00239     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00240 }
00241 
00242 
00243 
00244 
00245 <span class="comment">//-----------------------------------------------------------------------------</span>
00246 <span class="comment">// Name: ShowDialog</span>
00247 <span class="comment">// Desc: Show the D3D settings dialog.</span>
00248 <span class="comment">//-----------------------------------------------------------------------------</span>
00249 INT_PTR CD3DSettingsDialog::ShowDialog( HWND hwndParent )
00250 {
00251     <span class="keywordflow">return</span> DialogBox( NULL, MAKEINTRESOURCE( IDD_SELECTDEVICE ), 
00252         hwndParent, DialogProcHelper );
00253 }
00254 
00255 
00256 
00257 
00258 <span class="comment">//-----------------------------------------------------------------------------</span>
00259 <span class="comment">// Name: DialogProc</span>
00260 <span class="comment">// Desc: Handle window messages in the dialog.</span>
00261 <span class="comment">//-----------------------------------------------------------------------------</span>
00262 INT_PTR CD3DSettingsDialog::DialogProc( HWND hDlg, UINT msg, WPARAM wParam, LPARAM lParam )
00263 {
00264     UNREFERENCED_PARAMETER( lParam );
00265 
00266     <span class="keywordflow">switch</span>( msg )
00267     {
00268     <span class="keywordflow">case</span> WM_INITDIALOG:
00269         {
00270             m_hDlg = hDlg;
00271 
00272             <span class="comment">// Fill adapter combo box.  Updating the selected adapter will trigger</span>
00273             <span class="comment">// updates of the rest of the dialog.</span>
00274             <span class="keywordflow">for</span>( UINT i = 0; i &lt; m_pEnumeration-&gt;m_AdapterInfoList.size(); i++ )
00275             {
00276                 <span class="keyword">const</span> D3DAdapterInfo&amp; adInfo = m_pEnumeration-&gt;m_AdapterInfoList[i];
00277                 TCHAR strDescription[512];
00278                 DXUtil_ConvertAnsiStringToGenericCch( strDescription, adInfo.m_Identifier.Description, 512 );
00279                 ComboBoxAdd( IDC_ADAPTER_COMBO, &amp;adInfo, strDescription );
00280                 <span class="keywordflow">if</span> (adInfo.m_Ordinal == m_d3dSettings.Ordinal()) ComboBoxSelect( IDC_ADAPTER_COMBO, &amp;adInfo );
00281             }
00282             <span class="keywordflow">if</span>( !ComboBoxSomethingSelected( IDC_ADAPTER_COMBO ) &amp;&amp;
00283                 ComboBoxCount( IDC_ADAPTER_COMBO ) &gt; 0 )
00284             {
00285                 ComboBoxSelectIndex( IDC_ADAPTER_COMBO, 0 );
00286             }
00287         }
00288         <span class="keywordflow">return</span> TRUE;
00289 
00290     <span class="keywordflow">case</span> WM_COMMAND:
00291         <span class="keywordflow">switch</span>( LOWORD(wParam) )
00292         {
00293         <span class="keywordflow">case</span> IDOK:
00294             EndDialog( hDlg, IDOK );
00295             <span class="keywordflow">break</span>;
00296         <span class="keywordflow">case</span> IDCANCEL:
00297             EndDialog( hDlg, IDCANCEL );
00298             <span class="keywordflow">break</span>;
00299         <span class="keywordflow">case</span> IDC_ADAPTER_COMBO:
00300             <span class="keywordflow">if</span>( CBN_SELCHANGE == HIWORD(wParam) )
00301                 AdapterChanged();
00302             <span class="keywordflow">break</span>;
00303         <span class="keywordflow">case</span> IDC_DEVICE_COMBO:
00304             <span class="keywordflow">if</span>( CBN_SELCHANGE == HIWORD(wParam) )
00305                 DeviceChanged();
00306             <span class="keywordflow">break</span>;
00307         <span class="keywordflow">case</span> IDC_ADAPTERFORMAT_COMBO:
00308             <span class="keywordflow">if</span>( CBN_SELCHANGE == HIWORD(wParam) )
00309                 AdapterFormatChanged();
00310             <span class="keywordflow">break</span>;
00311         <span class="keywordflow">case</span> IDC_RESOLUTION_COMBO:
00312             <span class="keywordflow">if</span>( CBN_SELCHANGE == HIWORD(wParam) )
00313                 ResolutionChanged();
00314             <span class="keywordflow">break</span>;
00315         <span class="keywordflow">case</span> IDC_REFRESHRATE_COMBO:
00316             <span class="keywordflow">if</span>( CBN_SELCHANGE == HIWORD(wParam) )
00317                 RefreshRateChanged();
00318             <span class="keywordflow">break</span>;
00319         <span class="keywordflow">case</span> IDC_BACKBUFFERFORMAT_COMBO:
00320             <span class="keywordflow">if</span>( CBN_SELCHANGE == HIWORD(wParam) )
00321                 BackBufferFormatChanged();
00322             <span class="keywordflow">break</span>;
00323         <span class="keywordflow">case</span> IDC_DEPTHSTENCILBUFFERFORMAT_COMBO:
00324             <span class="keywordflow">if</span>( CBN_SELCHANGE == HIWORD(wParam) )
00325                 DSBufferFormatChanged();
00326             <span class="keywordflow">break</span>;
00327         <span class="keywordflow">case</span> IDC_MULTISAMPLE_COMBO:
00328             <span class="keywordflow">if</span>( CBN_SELCHANGE == HIWORD(wParam) )
00329                 MultisampleTypeChanged();
00330             <span class="keywordflow">break</span>;
00331         <span class="keywordflow">case</span> IDC_MULTISAMPLE_QUALITY_COMBO:
00332             <span class="keywordflow">if</span>( CBN_SELCHANGE == HIWORD(wParam) )
00333                 MultisampleQualityChanged();
00334             <span class="keywordflow">break</span>;
00335         <span class="keywordflow">case</span> IDC_VERTEXPROCESSING_COMBO:
00336             <span class="keywordflow">if</span>( CBN_SELCHANGE == HIWORD(wParam) )
00337                 VertexProcessingChanged();
00338             <span class="keywordflow">break</span>;
00339         <span class="keywordflow">case</span> IDC_PRESENTINTERVAL_COMBO:
00340             <span class="keywordflow">if</span>( CBN_SELCHANGE == HIWORD(wParam) )
00341                 PresentIntervalChanged();
00342             <span class="keywordflow">break</span>;
00343         <span class="keywordflow">case</span> IDC_DEVICECLIP_CHECK:
00344             <span class="keywordflow">if</span>( BN_CLICKED == HIWORD(wParam) )
00345                 DeviceClipChanged();
00346             <span class="keywordflow">break</span>;
00347         <span class="keywordflow">case</span> IDC_WINDOW:
00348         <span class="keywordflow">case</span> IDC_FULLSCREEN:
00349             WindowedFullscreenChanged();
00350             <span class="keywordflow">break</span>;
00351         }
00352         <span class="keywordflow">return</span> TRUE;
00353 
00354     <span class="keywordflow">default</span>:
00355         <span class="keywordflow">return</span> FALSE;
00356     }
00357 }
00358 
00359 
00360 
00361 <span class="comment">//-----------------------------------------------------------------------------</span>
00362 <span class="comment">// Name: AdapterChanged</span>
00363 <span class="comment">// Desc: Respond to a change of selected adapter.</span>
00364 <span class="comment">//-----------------------------------------------------------------------------</span>
00365 <span class="keywordtype">void</span> CD3DSettingsDialog::AdapterChanged( <span class="keywordtype">void</span> )
00366 {
00367     D3DAdapterInfo* pAdapterInfo = (D3DAdapterInfo*)ComboBoxSelected( IDC_ADAPTER_COMBO );
00368     <span class="keywordflow">if</span>( pAdapterInfo == NULL )
00369         <span class="keywordflow">return</span>;
00370     
00371     <span class="keywordflow">if</span>( m_d3dSettings.m_bIsWindowed )
00372     {
00373         m_d3dSettings.pWindowed_AdapterInfo = pAdapterInfo;
00374 
00375         <span class="comment">// Set the windowed display mode format to what the</span>
00376         <span class="comment">// adapter is currently in.</span>
00377         IDirect3D9* pD3D = m_pEnumeration-&gt;GetD3D();
00378         <span class="keywordflow">if</span>( pD3D )
00379         {
00380             D3DDISPLAYMODE Mode;
00381             <span class="keywordflow">if</span>( SUCCEEDED( pD3D-&gt;GetAdapterDisplayMode( pAdapterInfo-&gt;m_Ordinal, &amp;Mode ) ) )
00382                 m_d3dSettings.Windowed_DisplayMode.Format = Mode.Format;
00383             SAFE_RELEASE( pD3D );
00384         }
00385     }
00386     <span class="keywordflow">else</span> m_d3dSettings.pFullscreen_AdapterInfo = pAdapterInfo;
00387 
00388     <span class="comment">// Update device combo box</span>
00389     ComboBoxClear( IDC_DEVICE_COMBO );
00390     <span class="keywordflow">for</span> (UINT i = 0; i &lt; pAdapterInfo-&gt;m_DevInfos.size(); i++)
00391     {
00392         <span class="keyword">const</span> D3DDeviceInfo&amp; devInfo = pAdapterInfo-&gt;m_DevInfos[i];
00393         ComboBoxAdd( IDC_DEVICE_COMBO, &amp;devInfo, D3DDevTypeToString( devInfo.m_DevType ) );
00394         <span class="keywordflow">if</span> (devInfo.m_DevType == m_d3dSettings.DevType()) 
00395         {
00396             ComboBoxSelect( IDC_DEVICE_COMBO, &amp;devInfo );
00397         }
00398     }
00399 
00400     <span class="keywordflow">if</span> (!ComboBoxSomethingSelected( IDC_DEVICE_COMBO ) &amp;&amp; 
00401             ComboBoxCount( IDC_DEVICE_COMBO ) &gt; 0 )
00402     {
00403         ComboBoxSelectIndex( IDC_DEVICE_COMBO, 0 );
00404     }
00405 } <span class="comment">// CD3DSettingsDialog::AdapterChanged</span>
00406 
00407 <span class="comment">//-----------------------------------------------------------------------------</span>
00408 <span class="comment">// Name: DeviceChanged</span>
00409 <span class="comment">// Desc: Respond to a change of selected device by resetting the </span>
00410 <span class="comment">//       fullscreen/windowed radio buttons.  Updating these buttons will </span>
00411 <span class="comment">//       trigger updates of the rest of the dialog.</span>
00412 <span class="comment">//-----------------------------------------------------------------------------</span>
00413 <span class="keywordtype">void</span> CD3DSettingsDialog::DeviceChanged( <span class="keywordtype">void</span> )
00414 {
00415     D3DDeviceInfo* pDeviceInfo = (D3DDeviceInfo*)ComboBoxSelected( IDC_DEVICE_COMBO );
00416     <span class="keywordflow">if</span>( pDeviceInfo == NULL )
00417         <span class="keywordflow">return</span>;
00418 
00419     <span class="keywordflow">if</span>( m_d3dSettings.m_bIsWindowed )
00420         m_d3dSettings.pWindowed_DeviceInfo = pDeviceInfo;
00421     <span class="keywordflow">else</span>
00422         m_d3dSettings.pFullscreen_DeviceInfo = pDeviceInfo;
00423 
00424     <span class="comment">// Update fullscreen/windowed radio buttons</span>
00425     <span class="keywordtype">bool</span> HasWindowedDeviceCombo = <span class="keyword">false</span>;
00426     <span class="keywordtype">bool</span> HasFullscreenDeviceCombo = <span class="keyword">false</span>;
00427     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; pDeviceInfo-&gt;m_DevCombos.size(); i++)
00428     {
00429         <span class="keyword">const</span> D3DDeviceCombo&amp; devCombo = pDeviceInfo-&gt;m_DevCombos[i];
00430         <span class="keywordflow">if</span> (devCombo.m_bIsWindowed ) HasWindowedDeviceCombo = <span class="keyword">true</span>; <span class="keywordflow">else</span> HasFullscreenDeviceCombo = <span class="keyword">true</span>;
00431     }
00432     EnableWindow( GetDlgItem( m_hDlg, IDC_WINDOW ), HasWindowedDeviceCombo );
00433     EnableWindow( GetDlgItem( m_hDlg, IDC_FULLSCREEN ), HasFullscreenDeviceCombo );
00434     <span class="keywordflow">if</span> (m_d3dSettings.m_bIsWindowed &amp;&amp; HasWindowedDeviceCombo)
00435     {
00436         CheckRadioButton( m_hDlg, IDC_WINDOW, IDC_FULLSCREEN, IDC_WINDOW );
00437     }
00438     <span class="keywordflow">else</span>
00439     {
00440         CheckRadioButton( m_hDlg, IDC_WINDOW, IDC_FULLSCREEN, IDC_FULLSCREEN );
00441     }
00442     WindowedFullscreenChanged();
00443 } <span class="comment">// CD3DSettingsDialog::DeviceChanged</span>
00444 
00445 <span class="comment">//-----------------------------------------------------------------------------</span>
00446 <span class="comment">// Name: WindowedFullscreenChanged</span>
00447 <span class="comment">// Desc: Respond to a change of windowed/fullscreen state by rebuilding the</span>
00448 <span class="comment">//       adapter format list, resolution list, and refresh rate list.</span>
00449 <span class="comment">//       Updating the selected adapter format will trigger updates of the </span>
00450 <span class="comment">//       rest of the dialog.</span>
00451 <span class="comment">//-----------------------------------------------------------------------------</span>
00452 <span class="keywordtype">void</span> CD3DSettingsDialog::WindowedFullscreenChanged( <span class="keywordtype">void</span> )
00453 {
00454     D3DAdapterInfo* pAdapterInfo = (D3DAdapterInfo*)ComboBoxSelected( IDC_ADAPTER_COMBO );
00455     D3DDeviceInfo*  pDeviceInfo  = (D3DDeviceInfo*)ComboBoxSelected( IDC_DEVICE_COMBO );
00456     <span class="keywordflow">if</span>( pAdapterInfo == NULL || pDeviceInfo == NULL ) <span class="keywordflow">return</span>;
00457 
00458     <span class="keywordflow">if</span>( IsDlgButtonChecked( m_hDlg, IDC_WINDOW ) )
00459     {
00460         m_d3dSettings.m_bIsWindowed = <span class="keyword">true</span>;
00461         m_d3dSettings.pWindowed_AdapterInfo = pAdapterInfo;
00462         m_d3dSettings.pWindowed_DeviceInfo = pDeviceInfo;
00463 
00464         <span class="comment">// Update device clip check box</span>
00465         EnableWindow( GetDlgItem( m_hDlg, IDC_DEVICECLIP_CHECK ), <span class="keyword">true</span> );
00466         <span class="keywordflow">if</span> (m_d3dSettings.DeviceClip() )
00467             SendMessage( GetDlgItem( m_hDlg, IDC_DEVICECLIP_CHECK ), BM_SETCHECK, BST_CHECKED, 0 );
00468         <span class="keywordflow">else</span>
00469             SendMessage( GetDlgItem( m_hDlg, IDC_DEVICECLIP_CHECK ), BM_SETCHECK, BST_UNCHECKED, 0 );
00470 
00471         <span class="comment">// Update adapter format combo box</span>
00472         ComboBoxClear( IDC_ADAPTERFORMAT_COMBO );
00473         ComboBoxAdd( IDC_ADAPTERFORMAT_COMBO, (<span class="keywordtype">void</span>*)m_d3dSettings.Windowed_DisplayMode.Format,
00474             D3DUtil_D3DFormatToString( m_d3dSettings.Windowed_DisplayMode.Format ) );
00475         ComboBoxSelectIndex( IDC_ADAPTERFORMAT_COMBO, 0 );
00476         EnableWindow( GetDlgItem( m_hDlg, IDC_ADAPTERFORMAT_COMBO ), <span class="keyword">false</span> );
00477 
00478         <span class="comment">// Update resolution combo box</span>
00479         DWORD dwResolutionData;
00480         TCHAR strResolution[50];
00481         dwResolutionData = MAKELONG( m_d3dSettings.Windowed_DisplayMode.Width,
00482                                      m_d3dSettings.Windowed_DisplayMode.Height );
00483         _sntprintf( strResolution, 50, TEXT(<span class="stringliteral">"%d by %d"</span>), m_d3dSettings.Windowed_DisplayMode.Width, 
00484             m_d3dSettings.Windowed_DisplayMode.Height );
00485         strResolution[49] = 0;
00486         ComboBoxClear( IDC_RESOLUTION_COMBO );
00487         ComboBoxAdd( IDC_RESOLUTION_COMBO, ULongToPtr(dwResolutionData), strResolution );
00488         ComboBoxSelectIndex( IDC_RESOLUTION_COMBO, 0 );
00489         EnableWindow( GetDlgItem( m_hDlg, IDC_RESOLUTION_COMBO ), <span class="keyword">false</span> );
00490 
00491         <span class="comment">// Update refresh rate combo box</span>
00492         TCHAR strRefreshRate[50];
00493         <span class="keywordflow">if</span>( m_d3dSettings.Windowed_DisplayMode.RefreshRate == 0 )
00494             lstrcpy( strRefreshRate, TEXT(<span class="stringliteral">"Default Rate"</span>) );
00495         <span class="keywordflow">else</span>
00496             _sntprintf( strRefreshRate, 50, TEXT(<span class="stringliteral">"%d Hz"</span>), m_d3dSettings.Windowed_DisplayMode.RefreshRate );
00497         strRefreshRate[49] = 0;
00498         ComboBoxClear( IDC_REFRESHRATE_COMBO );
00499         ComboBoxAdd( IDC_REFRESHRATE_COMBO, ULongToPtr(m_d3dSettings.Windowed_DisplayMode.RefreshRate),
00500             strRefreshRate );
00501         ComboBoxSelectIndex( IDC_REFRESHRATE_COMBO, 0 );
00502         EnableWindow( GetDlgItem( m_hDlg, IDC_REFRESHRATE_COMBO ), <span class="keyword">false</span> );
00503     }
00504     <span class="keywordflow">else</span>
00505     {
00506         m_d3dSettings.m_bIsWindowed = <span class="keyword">false</span>;
00507         m_d3dSettings.pFullscreen_AdapterInfo = pAdapterInfo;
00508         m_d3dSettings.pFullscreen_DeviceInfo = pDeviceInfo;
00509 
00510         <span class="comment">// Update device clip check box</span>
00511         EnableWindow( GetDlgItem( m_hDlg, IDC_DEVICECLIP_CHECK ), <span class="keyword">false</span> );
00512 
00513         <span class="comment">// Update adapter format combo box</span>
00514         ComboBoxClear( IDC_ADAPTERFORMAT_COMBO );
00515         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; pDeviceInfo-&gt;m_DevCombos.size(); i++ )
00516         {
00517             <span class="keyword">const</span> D3DDeviceCombo&amp; devCombo = pDeviceInfo-&gt;m_DevCombos[i];
00518             <span class="keywordflow">if</span> (devCombo.m_bIsWindowed) <span class="keywordflow">continue</span>;
00519             D3DFORMAT adapterFormat = devCombo.m_AdapterFormat;
00520             <span class="keywordflow">if</span> (!ComboBoxContainsText( IDC_ADAPTERFORMAT_COMBO, D3DUtil_D3DFormatToString( adapterFormat ) ))
00521             {
00522                 ComboBoxAdd( IDC_ADAPTERFORMAT_COMBO, (<span class="keywordtype">void</span>*)adapterFormat, 
00523                     D3DUtil_D3DFormatToString( adapterFormat ) );
00524                 <span class="keywordflow">if</span>( adapterFormat == m_d3dSettings.Fullscreen_DisplayMode.Format )
00525                 {
00526                     ComboBoxSelect( IDC_ADAPTERFORMAT_COMBO, (<span class="keywordtype">void</span>*)adapterFormat );
00527                 }
00528             }
00529         }
00530         <span class="keywordflow">if</span>( !ComboBoxSomethingSelected( IDC_ADAPTERFORMAT_COMBO ) &amp;&amp;
00531             ComboBoxCount( IDC_ADAPTERFORMAT_COMBO ) &gt; 0 )
00532         {
00533             ComboBoxSelectIndex( IDC_ADAPTERFORMAT_COMBO, 0 );
00534         }
00535         EnableWindow( GetDlgItem( m_hDlg, IDC_ADAPTERFORMAT_COMBO), <span class="keyword">true</span> );
00536         
00537         <span class="comment">// Update resolution combo box</span>
00538         EnableWindow( GetDlgItem( m_hDlg, IDC_RESOLUTION_COMBO), <span class="keyword">true</span> );
00539         
00540         <span class="comment">// Update refresh rate combo box</span>
00541         EnableWindow( GetDlgItem( m_hDlg, IDC_REFRESHRATE_COMBO), <span class="keyword">true</span> );
00542     }
00543 }
00544 
00545 <span class="comment">//-----------------------------------------------------------------------------</span>
00546 <span class="comment">// Name: AdapterFormatChanged</span>
00547 <span class="comment">// Desc: Respond to a change of selected adapter format by rebuilding the</span>
00548 <span class="comment">//       resolution list and back buffer format list.  Updating the selected </span>
00549 <span class="comment">//       resolution and back buffer format will trigger updates of the rest </span>
00550 <span class="comment">//       of the dialog.</span>
00551 <span class="comment">//-----------------------------------------------------------------------------</span>
00552 <span class="keywordtype">void</span> CD3DSettingsDialog::AdapterFormatChanged( <span class="keywordtype">void</span> )
00553 {
00554     <span class="keywordflow">if</span>( !IsDlgButtonChecked( m_hDlg, IDC_WINDOW ) )
00555     {
00556         D3DAdapterInfo* pAdapterInfo = (D3DAdapterInfo*)ComboBoxSelected( IDC_ADAPTER_COMBO );
00557         D3DFORMAT adapterFormat = (D3DFORMAT)PtrToUlong( ComboBoxSelected( IDC_ADAPTERFORMAT_COMBO ) );
00558         m_d3dSettings.Fullscreen_DisplayMode.Format = adapterFormat;
00559 
00560         ComboBoxClear( IDC_RESOLUTION_COMBO );
00561         <span class="keywordflow">for</span>( UINT idm = 0; idm &lt; pAdapterInfo-&gt;m_DisplayModes.size(); idm++ )
00562         {
00563             D3DDISPLAYMODE displayMode = pAdapterInfo-&gt;m_DisplayModes[idm];
00564             <span class="keywordflow">if</span> (displayMode.Format == adapterFormat)
00565             {
00566                 DWORD dwResolutionData;
00567                 TCHAR strResolution[50];
00568                 dwResolutionData = MAKELONG( displayMode.Width, displayMode.Height );
00569                 _sntprintf( strResolution, 50, TEXT(<span class="stringliteral">"%d by %d"</span>), displayMode.Width, displayMode.Height );
00570                 strResolution[49] = 0;
00571                 <span class="keywordflow">if</span> (!ComboBoxContainsText( IDC_RESOLUTION_COMBO, strResolution ) )
00572                 {
00573                     ComboBoxAdd( IDC_RESOLUTION_COMBO, ULongToPtr( dwResolutionData ), strResolution );
00574                     <span class="keywordflow">if</span> (m_d3dSettings.Fullscreen_DisplayMode.Width == displayMode.Width &amp;&amp;
00575                         m_d3dSettings.Fullscreen_DisplayMode.Height == displayMode.Height)
00576                     {
00577                         ComboBoxSelect( IDC_RESOLUTION_COMBO, ULongToPtr( dwResolutionData ) );
00578                     }
00579                 }
00580             }
00581         }
00582         <span class="keywordflow">if</span> (!ComboBoxSomethingSelected( IDC_RESOLUTION_COMBO ) &amp;&amp; 
00583             ComboBoxCount( IDC_RESOLUTION_COMBO ) &gt; 0)
00584         {
00585             ComboBoxSelectIndex( IDC_RESOLUTION_COMBO, 0 );
00586         }
00587     }
00588 
00589     <span class="comment">// Update backbuffer format combo box</span>
00590     D3DDeviceInfo* pDeviceInfo = (D3DDeviceInfo*)ComboBoxSelected( IDC_DEVICE_COMBO );
00591     <span class="keywordflow">if</span> (pDeviceInfo == NULL) <span class="keywordflow">return</span>;
00592     <span class="keywordtype">bool</span> bHasWindowedBackbuffer = <span class="keyword">false</span>;
00593     ComboBoxClear( IDC_BACKBUFFERFORMAT_COMBO );
00594     <span class="keywordflow">for</span> (UINT idc = 0; idc &lt; pDeviceInfo-&gt;m_DevCombos.size(); idc++)
00595     {
00596         <span class="keyword">const</span> D3DDeviceCombo&amp; devCombo = pDeviceInfo-&gt;m_DevCombos[idc];
00597         <span class="keywordflow">if</span> (devCombo.m_bIsWindowed == m_d3dSettings.m_bIsWindowed &amp;&amp;
00598             devCombo.m_AdapterFormat == m_d3dSettings.DisplayMode().Format)
00599         {
00600             <span class="keywordflow">if</span> (!ComboBoxContainsText( IDC_BACKBUFFERFORMAT_COMBO, 
00601                 D3DUtil_D3DFormatToString( devCombo.m_BackBufferFormat ) ) )
00602             {
00603                 ComboBoxAdd( IDC_BACKBUFFERFORMAT_COMBO, (<span class="keywordtype">void</span>*)devCombo.m_BackBufferFormat,
00604                                 D3DUtil_D3DFormatToString( devCombo.m_BackBufferFormat ) );
00605                 <span class="keywordflow">if</span> (devCombo.m_BackBufferFormat == m_d3dSettings.BackBufferFormat() )
00606                 {
00607                     ComboBoxSelect( IDC_BACKBUFFERFORMAT_COMBO, (<span class="keywordtype">void</span>*)devCombo.m_BackBufferFormat );
00608                 }
00609             }
00610         }
00611 
00612         <span class="comment">// Count the number of backbuffer format supported for windowed mode</span>
00613         <span class="keywordflow">if</span>( <span class="keyword">true</span> == devCombo.m_bIsWindowed &amp;&amp;
00614             devCombo.m_AdapterFormat == m_d3dSettings.Windowed_DisplayMode.Format )
00615         {
00616             bHasWindowedBackbuffer = <span class="keyword">true</span>;
00617         }
00618     }
00619 
00620     <span class="comment">// If no backbuffer format is allowed and this is windowed, then the adapter</span>
00621     <span class="comment">// cannot handle 3D in the format the desktop is currently in.  Force</span>
00622     <span class="comment">// fullscreen in this case.</span>
00623     <span class="keywordflow">if</span>( !bHasWindowedBackbuffer )
00624     {
00625         EnableWindow( GetDlgItem( m_hDlg, IDC_WINDOW ), FALSE );
00626         <span class="keywordflow">if</span>( m_d3dSettings.m_bIsWindowed )
00627         {
00628             CheckRadioButton( m_hDlg, IDC_WINDOW, IDC_FULLSCREEN, IDC_FULLSCREEN );
00629             WindowedFullscreenChanged();
00630         }
00631     }
00632 
00633     <span class="keywordflow">if</span> (!ComboBoxSomethingSelected( IDC_BACKBUFFERFORMAT_COMBO ) &amp;&amp; 
00634         ComboBoxCount( IDC_BACKBUFFERFORMAT_COMBO ) &gt; 0)
00635     {
00636         ComboBoxSelectIndex( IDC_BACKBUFFERFORMAT_COMBO, 0 );
00637     }
00638 } <span class="comment">// CD3DSettingsDialog::AdapterFormatChanged</span>
00639 
00640 <span class="comment">//-----------------------------------------------------------------------------</span>
00641 <span class="comment">// Name: ResolutionChanged</span>
00642 <span class="comment">// Desc: Respond to a change of selected resolution by rebuilding the</span>
00643 <span class="comment">//       refresh rate list.</span>
00644 <span class="comment">//-----------------------------------------------------------------------------</span>
00645 <span class="keywordtype">void</span> CD3DSettingsDialog::ResolutionChanged( <span class="keywordtype">void</span> )
00646 {
00647     <span class="keywordflow">if</span> (m_d3dSettings.m_bIsWindowed)
00648         <span class="keywordflow">return</span>;
00649 
00650     D3DAdapterInfo* pAdapterInfo = (D3DAdapterInfo*)ComboBoxSelected( IDC_ADAPTER_COMBO );
00651     <span class="keywordflow">if</span>( pAdapterInfo == NULL )
00652         <span class="keywordflow">return</span>;
00653 
00654     <span class="comment">// Update settingsNew with new resolution</span>
00655     DWORD dwResolutionData = PtrToUlong( ComboBoxSelected( IDC_RESOLUTION_COMBO ) );
00656     UINT width = LOWORD( dwResolutionData );
00657     UINT height = HIWORD( dwResolutionData );
00658     m_d3dSettings.Fullscreen_DisplayMode.Width = width;
00659     m_d3dSettings.Fullscreen_DisplayMode.Height = height;
00660 
00661     <span class="comment">// Update refresh rate list based on new resolution</span>
00662     D3DFORMAT adapterFormat = (D3DFORMAT)PtrToUlong( ComboBoxSelected( IDC_ADAPTERFORMAT_COMBO ) );
00663     ComboBoxClear( IDC_REFRESHRATE_COMBO );
00664     <span class="keywordflow">for</span>( UINT idm = 0; idm &lt; pAdapterInfo-&gt;m_DisplayModes.size(); idm++ )
00665     {
00666         D3DDISPLAYMODE displayMode = pAdapterInfo-&gt;m_DisplayModes[idm];
00667         <span class="keywordflow">if</span> (displayMode.Format == adapterFormat &amp;&amp;
00668             displayMode.Width  == width &amp;&amp;
00669             displayMode.Height == height)
00670         {
00671             TCHAR strRefreshRate[50];
00672             <span class="keywordflow">if</span>( displayMode.RefreshRate == 0 )
00673                 lstrcpy( strRefreshRate, TEXT(<span class="stringliteral">"Default Rate"</span>) );
00674             <span class="keywordflow">else</span>
00675                 _sntprintf( strRefreshRate, 50, TEXT(<span class="stringliteral">"%d Hz"</span>), displayMode.RefreshRate );
00676             strRefreshRate[49] = 0;
00677             <span class="keywordflow">if</span>( !ComboBoxContainsText( IDC_REFRESHRATE_COMBO, strRefreshRate ) )
00678             {
00679                 ComboBoxAdd( IDC_REFRESHRATE_COMBO, UlongToPtr( displayMode.RefreshRate ), strRefreshRate );
00680                 <span class="keywordflow">if</span> (m_d3dSettings.Fullscreen_DisplayMode.RefreshRate == displayMode.RefreshRate)
00681                     ComboBoxSelect( IDC_REFRESHRATE_COMBO, UlongToPtr( displayMode.RefreshRate ) );
00682             }
00683         }
00684     }
00685     <span class="keywordflow">if</span> (!ComboBoxSomethingSelected( IDC_REFRESHRATE_COMBO ) &amp;&amp; 
00686         ComboBoxCount( IDC_REFRESHRATE_COMBO ) &gt; 0)
00687     {
00688         ComboBoxSelectIndex( IDC_REFRESHRATE_COMBO, 0 );
00689     }
00690 }
00691 
00692 
00693 
00694 
00695 <span class="comment">//-----------------------------------------------------------------------------</span>
00696 <span class="comment">// Name: RefreshRateChanged</span>
00697 <span class="comment">// Desc: Respond to a change of selected refresh rate.</span>
00698 <span class="comment">//-----------------------------------------------------------------------------</span>
00699 <span class="keywordtype">void</span> CD3DSettingsDialog::RefreshRateChanged( <span class="keywordtype">void</span> )
00700 {
00701     <span class="keywordflow">if</span>( m_d3dSettings.m_bIsWindowed )
00702         <span class="keywordflow">return</span>;
00703 
00704     <span class="comment">// Update settingsNew with new refresh rate</span>
00705     UINT refreshRate = PtrToUlong( ComboBoxSelected( IDC_REFRESHRATE_COMBO ) );
00706     m_d3dSettings.Fullscreen_DisplayMode.RefreshRate = refreshRate;
00707 }
00708 
00709 
00710 
00711 
00712 <span class="comment">//-----------------------------------------------------------------------------</span>
00713 <span class="comment">// Name: BackBufferFormatChanged</span>
00714 <span class="comment">// Desc: Respond to a change of selected back buffer format by rebuilding</span>
00715 <span class="comment">//       the depth/stencil format list, multisample type list, and vertex</span>
00716 <span class="comment">//       processing type list.</span>
00717 <span class="comment">//-----------------------------------------------------------------------------</span>
00718 <span class="keywordtype">void</span> CD3DSettingsDialog::BackBufferFormatChanged( <span class="keywordtype">void</span> )
00719 {
00720     D3DDeviceInfo* pDeviceInfo  = (D3DDeviceInfo*)ComboBoxSelected( IDC_DEVICE_COMBO );
00721     D3DFORMAT adapterFormat     = (D3DFORMAT)PtrToUlong( ComboBoxSelected( IDC_ADAPTERFORMAT_COMBO ) );
00722     D3DFORMAT backBufferFormat  = (D3DFORMAT)PtrToUlong( ComboBoxSelected( IDC_BACKBUFFERFORMAT_COMBO ) );
00723     <span class="keywordflow">if</span>( pDeviceInfo == NULL ) <span class="keywordflow">return</span>;
00724 
00725     <span class="keywordflow">for</span>( UINT i = 0; i &lt; pDeviceInfo-&gt;m_DevCombos.size(); i++ )
00726     {
00727         D3DDeviceCombo&amp; devCombo = pDeviceInfo-&gt;m_DevCombos[i];
00728         <span class="keywordflow">if</span> (devCombo.m_bIsWindowed == m_d3dSettings.m_bIsWindowed &amp;&amp;
00729             devCombo.m_AdapterFormat == adapterFormat &amp;&amp;
00730             devCombo.m_BackBufferFormat == backBufferFormat)
00731         {
00732             <span class="keywordflow">if</span>( m_d3dSettings.m_bIsWindowed ) m_d3dSettings.pWindowed_DeviceCombo = &amp;devCombo;
00733             <span class="keywordflow">else</span> m_d3dSettings.pFullscreen_DeviceCombo = &amp;devCombo;
00734             ComboBoxClear( IDC_DEPTHSTENCILBUFFERFORMAT_COMBO );
00735             <span class="keywordflow">if</span> (m_pEnumeration-&gt;m_bUseZBuffer)
00736             {
00737                 <span class="keywordflow">for</span>( UINT ifmt = 0; ifmt &lt; devCombo.m_DepthStencilFormats.size(); ifmt++ )
00738                 {
00739                     D3DFORMAT fmt = *(D3DFORMAT*)devCombo.m_DepthStencilFormats[ifmt];
00740                     ComboBoxAdd( IDC_DEPTHSTENCILBUFFERFORMAT_COMBO, (<span class="keywordtype">void</span>*)fmt, D3DUtil_D3DFormatToString(fmt) );
00741                     <span class="keywordflow">if</span>( fmt == m_d3dSettings.DepthStencilBufferFormat() )
00742                         ComboBoxSelect( IDC_DEPTHSTENCILBUFFERFORMAT_COMBO, (<span class="keywordtype">void</span>*)fmt );
00743                 }
00744                 <span class="keywordflow">if</span> (!ComboBoxSomethingSelected( IDC_DEPTHSTENCILBUFFERFORMAT_COMBO ) &amp;&amp; 
00745                     ComboBoxCount( IDC_DEPTHSTENCILBUFFERFORMAT_COMBO ) &gt; 0)
00746                 {
00747                     ComboBoxSelectIndex( IDC_DEPTHSTENCILBUFFERFORMAT_COMBO, 0 );
00748                 }
00749             }
00750             <span class="keywordflow">else</span>
00751             {
00752                 EnableWindow( GetDlgItem( m_hDlg, IDC_DEPTHSTENCILBUFFERFORMAT_COMBO ), <span class="keyword">false</span> );
00753                 ComboBoxAdd( IDC_DEPTHSTENCILBUFFERFORMAT_COMBO, NULL, TEXT(<span class="stringliteral">"(not used)"</span>) );
00754                 ComboBoxSelectIndex( IDC_DEPTHSTENCILBUFFERFORMAT_COMBO, 0 );
00755             }
00756 
00757             ComboBoxClear( IDC_VERTEXPROCESSING_COMBO );
00758             <span class="keywordflow">for</span>( UINT ivpt = 0; ivpt &lt; devCombo.m_VProcessTypes.size(); ivpt++ )
00759             {
00760                 VertexProcessingType vpt = devCombo.m_VProcessTypes[ivpt];
00761                 ComboBoxAdd( IDC_VERTEXPROCESSING_COMBO, (<span class="keywordtype">void</span>*)vpt, VertexProcessingTypeToString(vpt) );
00762                 <span class="keywordflow">if</span> (vpt == m_d3dSettings.GetVertexProcessingType()) ComboBoxSelect( IDC_VERTEXPROCESSING_COMBO, (<span class="keywordtype">void</span>*)vpt );
00763             }
00764             <span class="keywordflow">if</span> (!ComboBoxSomethingSelected( IDC_VERTEXPROCESSING_COMBO ) &amp;&amp; 
00765                 ComboBoxCount( IDC_VERTEXPROCESSING_COMBO ) &gt; 0)
00766             {
00767                 ComboBoxSelectIndex( IDC_VERTEXPROCESSING_COMBO, 0 );
00768             }
00769 
00770             ComboBoxClear( IDC_PRESENTINTERVAL_COMBO );
00771             <span class="keywordflow">for</span>( UINT ipi = 0; ipi &lt; devCombo.m_PresentIntervals.size(); ipi++ )
00772             {
00773                 UINT pi = devCombo.m_PresentIntervals[ipi];
00774                 ComboBoxAdd( IDC_PRESENTINTERVAL_COMBO, UlongToPtr( pi ), PresentIntervalToString(pi) );
00775                 <span class="keywordflow">if</span>( pi == m_d3dSettings.PresentInterval() )
00776                     ComboBoxSelect( IDC_PRESENTINTERVAL_COMBO, UlongToPtr( pi ) );
00777             }
00778             <span class="keywordflow">if</span> (!ComboBoxSomethingSelected( IDC_PRESENTINTERVAL_COMBO ) &amp;&amp; 
00779                 ComboBoxCount( IDC_PRESENTINTERVAL_COMBO ) &gt; 0)
00780             {
00781                 ComboBoxSelectIndex( IDC_PRESENTINTERVAL_COMBO, 0 );
00782             }
00783 
00784             <span class="keywordflow">break</span>;
00785         }
00786     }
00787 } <span class="comment">// CD3DSettingsDialog::BackBufferFormatChanged</span>
00788 
00789 <span class="comment">//-----------------------------------------------------------------------------</span>
00790 <span class="comment">// Name: DSBufferFormatChanged</span>
00791 <span class="comment">// Desc: Respond to a change of selected depth/stencil buffer format.</span>
00792 <span class="comment">//-----------------------------------------------------------------------------</span>
00793 <span class="keywordtype">void</span> CD3DSettingsDialog::DSBufferFormatChanged( <span class="keywordtype">void</span> )
00794 {
00795     D3DFORMAT fmt = (D3DFORMAT)PtrToUlong( ComboBoxSelected( IDC_DEPTHSTENCILBUFFERFORMAT_COMBO ) );
00796     <span class="keywordflow">if</span> (m_pEnumeration-&gt;m_bUseZBuffer) m_d3dSettings.SetDepthStencilBufferFormat( fmt );
00797 
00798     <span class="comment">// Build multisample list</span>
00799     D3DDeviceCombo* pDeviceCombo = m_d3dSettings.PDeviceCombo();
00800     ComboBoxClear( IDC_MULTISAMPLE_COMBO );
00801     <span class="keywordflow">for</span>( UINT ims = 0; ims &lt; pDeviceCombo-&gt;m_MSampleTypes.size(); ims++ )
00802     {
00803         D3DMULTISAMPLE_TYPE msType = *(D3DMULTISAMPLE_TYPE*)pDeviceCombo-&gt;m_MSampleTypes[ims];
00804 
00805         <span class="comment">// check for DS/MS conflicts</span>
00806         BOOL bConflictFound = FALSE;
00807         <span class="keywordflow">for</span>( UINT iConf = 0; iConf &lt; pDeviceCombo-&gt;m_DSMSConflicts.size(); iConf++ )
00808         {
00809             D3DDSMSConflict* pDSMSConf = &amp;pDeviceCombo-&gt;m_DSMSConflicts[iConf];
00810             <span class="keywordflow">if</span>( pDSMSConf-&gt;m_DSFormat == fmt &amp;&amp; pDSMSConf-&gt;m_MSType == msType )
00811             {
00812                 bConflictFound = TRUE;
00813                 <span class="keywordflow">break</span>;
00814             }
00815         }
00816         <span class="keywordflow">if</span>( !bConflictFound )
00817         {
00818             ComboBoxAdd( IDC_MULTISAMPLE_COMBO, (<span class="keywordtype">void</span>*)msType, MultisampleTypeToString(msType) );
00819             <span class="keywordflow">if</span>( msType == m_d3dSettings.MultisampleType() )
00820                 ComboBoxSelect( IDC_MULTISAMPLE_COMBO, (<span class="keywordtype">void</span>*)msType );
00821         }
00822     }
00823     <span class="keywordflow">if</span> (!ComboBoxSomethingSelected( IDC_MULTISAMPLE_COMBO ) &amp;&amp; 
00824         ComboBoxCount( IDC_MULTISAMPLE_COMBO ) &gt; 0)
00825     {
00826         ComboBoxSelectIndex( IDC_MULTISAMPLE_COMBO, 0 );
00827     }
00828 } <span class="comment">// CD3DSettingsDialog::DSBufferFormatChanged</span>
00829 
00830 <span class="comment">//-----------------------------------------------------------------------------</span>
00831 <span class="comment">// Name: MultisampleTypeChanged</span>
00832 <span class="comment">// Desc: Respond to a change of selected multisample type.</span>
00833 <span class="comment">//-----------------------------------------------------------------------------</span>
00834 <span class="keywordtype">void</span> CD3DSettingsDialog::MultisampleTypeChanged( <span class="keywordtype">void</span> )
00835 {
00836     D3DMULTISAMPLE_TYPE mst = (D3DMULTISAMPLE_TYPE)PtrToUlong( ComboBoxSelected( IDC_MULTISAMPLE_COMBO ) );
00837     m_d3dSettings.SetMultisampleType( mst );
00838 
00839     <span class="comment">// Set up max quality for this mst</span>
00840     D3DDeviceCombo* pDeviceCombo = m_d3dSettings.PDeviceCombo();
00841     DWORD maxQuality = 0;
00842 
00843     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ims = 0; ims &lt; pDeviceCombo-&gt;m_MSampleTypes.size(); ims++)
00844     {
00845         D3DMULTISAMPLE_TYPE msType = *(D3DMULTISAMPLE_TYPE*)pDeviceCombo-&gt;m_MSampleTypes[ims];
00846         <span class="keywordflow">if</span>( msType == mst )
00847         {
00848             maxQuality = pDeviceCombo-&gt;m_MSampleQualities[ims];
00849             <span class="keywordflow">break</span>;
00850         }
00851     }
00852 
00853     ComboBoxClear( IDC_MULTISAMPLE_QUALITY_COMBO );
00854     <span class="keywordflow">for</span>( UINT msq = 0; msq &lt; maxQuality; msq++ )
00855     {
00856         TCHAR str[100];
00857         wsprintf( str, TEXT(<span class="stringliteral">"%d"</span>), msq );
00858         ComboBoxAdd( IDC_MULTISAMPLE_QUALITY_COMBO, UlongToPtr( msq ), str );
00859         <span class="keywordflow">if</span>( msq == m_d3dSettings.MultisampleQuality() )
00860             ComboBoxSelect( IDC_MULTISAMPLE_QUALITY_COMBO, UlongToPtr( msq ) );
00861     }
00862     <span class="keywordflow">if</span> (!ComboBoxSomethingSelected( IDC_MULTISAMPLE_QUALITY_COMBO ) &amp;&amp; 
00863         ComboBoxCount( IDC_MULTISAMPLE_QUALITY_COMBO ) &gt; 0)
00864     {
00865         ComboBoxSelectIndex( IDC_MULTISAMPLE_QUALITY_COMBO, 0 );
00866     }
00867 } <span class="comment">// CD3DSettingsDialog::MultisampleTypeChanged</span>
00868 
00869 <span class="comment">//-----------------------------------------------------------------------------</span>
00870 <span class="comment">// Name: MultisampleQualityChanged</span>
00871 <span class="comment">// Desc: Respond to a change of selected multisample quality.</span>
00872 <span class="comment">//-----------------------------------------------------------------------------</span>
00873 <span class="keywordtype">void</span> CD3DSettingsDialog::MultisampleQualityChanged( <span class="keywordtype">void</span> )
00874 {
00875     DWORD msq = (DWORD)PtrToUlong( ComboBoxSelected( IDC_MULTISAMPLE_QUALITY_COMBO ) );
00876     m_d3dSettings.SetMultisampleQuality( msq );
00877 } <span class="comment">// CD3DSettingsDialog::MultisampleQualityChanged</span>
00878 
00879 <span class="comment">//-----------------------------------------------------------------------------</span>
00880 <span class="comment">// Name: VertexProcessingChanged</span>
00881 <span class="comment">// Desc: Respond to a change of selected vertex processing type.</span>
00882 <span class="comment">//-----------------------------------------------------------------------------</span>
00883 <span class="keywordtype">void</span> CD3DSettingsDialog::VertexProcessingChanged( <span class="keywordtype">void</span> )
00884 {
00885     VertexProcessingType vpt = (VertexProcessingType)PtrToUlong( ComboBoxSelected( IDC_VERTEXPROCESSING_COMBO ) );
00886     m_d3dSettings.SetVertexProcessingType( vpt );
00887 } <span class="comment">// CD3DSettingsDialog::VertexProcessingChanged</span>
00888 
00889 <span class="comment">//-----------------------------------------------------------------------------</span>
00890 <span class="comment">// Name: PresentIntervalChanged</span>
00891 <span class="comment">// Desc: Respond to a change of selected present interval.</span>
00892 <span class="comment">//-----------------------------------------------------------------------------</span>
00893 <span class="keywordtype">void</span> CD3DSettingsDialog::PresentIntervalChanged( <span class="keywordtype">void</span> )
00894 {
00895     UINT pi = PtrToUlong( ComboBoxSelected( IDC_PRESENTINTERVAL_COMBO ) );
00896     m_d3dSettings.SetPresentInterval( pi );
00897 } <span class="comment">// CD3DSettingsDialog::PresentIntervalChanged</span>
00898 
00899 <span class="comment">//-----------------------------------------------------------------------------</span>
00900 <span class="comment">// Name: DeviceClipChanged</span>
00901 <span class="comment">// Desc: Respond to a change of selected present interval.</span>
00902 <span class="comment">//-----------------------------------------------------------------------------</span>
00903 <span class="keywordtype">void</span> CD3DSettingsDialog::DeviceClipChanged( <span class="keywordtype">void</span> )
00904 {
00905     HWND hWndCheckBox = GetDlgItem( m_hDlg, IDC_DEVICECLIP_CHECK );
00906     <span class="keywordflow">if</span>( hWndCheckBox )
00907     {
00908         <span class="keywordtype">bool</span> bChecked = SendMessage( hWndCheckBox, BM_GETCHECK, 0, 0 ) == BST_CHECKED;
00909         m_d3dSettings.SetDeviceClip( bChecked );
00910     }
00911 } <span class="comment">// CD3DSettingsDialog::DeviceClipChanged</span>
</pre></div><hr><address style="align: right;"><small>
Generated on Tue Jun 13 11:14:33 2006 for gRenderDX9 by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.1 using KingsTools</small></address>
</body>
</html>
