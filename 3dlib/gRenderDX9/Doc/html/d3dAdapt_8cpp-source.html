<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>gRenderDX9: d3dAdapt.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<h1>d3dAdapt.cpp</h1><div class="fragment"><pre>00001 <span class="comment">/*****************************************************************************/</span>
00002 <span class="comment">/*  File:   d3dAdapt.cpp</span>
00003 <span class="comment">/*  Desc:   Utilities form mapping d3d constants/enumerations to/from the engine</span>
00004 <span class="comment">/*  Author: Ruslan Shestopalyuk</span>
00005 <span class="comment">/*  Date:   02.11.2004</span>
00006 <span class="comment">/*****************************************************************************/</span>
00007 <span class="preprocessor">#include "gRenderPch.h"</span>
00008 <span class="preprocessor">#include "d3dAdapt.h"</span>
00009 
00010 IDirect3DVertexDeclaration9* CreateVDecl( IDirect3DDevice9* pDevice, <span class="keyword">const</span> VertexDeclaration&amp; vdecl )
00011 {
00012     <span class="keywordflow">if</span> (!pDevice) <span class="keywordflow">return</span> NULL;
00013     IDirect3DVertexDeclaration9* pDecl = NULL;
00014     D3DVERTEXELEMENT9 elem[MAXD3DDECLLENGTH + 1];
00015     <span class="keywordtype">int</span> cElem = 0;
00016     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; vdecl.m_NElements; i++)
00017     {
00018         elem[cElem].Stream     = vdecl.m_Element[i].m_Stream;
00019         elem[cElem].Offset     = vdecl.m_Element[i].m_Offset;
00020         elem[cElem].Type       = ConvertVElemType  ( vdecl.m_Element[i].m_Type );
00021         elem[cElem].Method     = D3DDECLMETHOD_DEFAULT; 
00022         elem[cElem].Usage      = ConvertVElemUsage ( vdecl.m_Element[i].m_Usage );
00023         elem[cElem].UsageIndex = GetVElemUsageIndex( vdecl.m_Element[i].m_Usage );
00024         <span class="keywordflow">if</span> (MapsToD3DVElemUsage( vdecl.m_Element[i].m_Usage )) cElem++;
00025     }
00026     <span class="comment">//  end element</span>
00027     elem[cElem].Stream     = 0xFF; 
00028     elem[cElem].Offset     = 0;
00029     elem[cElem].Type       = D3DDECLTYPE_UNUSED;
00030     elem[cElem].Method     = 0;
00031     elem[cElem].Usage      = 0;
00032     elem[cElem].UsageIndex = 0;
00033     pDevice-&gt;CreateVertexDeclaration( elem, &amp;pDecl );
00034     <span class="keywordflow">return</span> pDecl;
00035 } <span class="comment">// CreateVDecl</span>
00036 
00037 DWORD CreateFVF( <span class="keyword">const</span> VertexDeclaration&amp; vdecl )
00038 {
00039     <span class="comment">/*    </span>
00040 <span class="comment">    D3DVERTEXELEMENT9 elem[MAXD3DDECLLENGTH + 1];</span>
00041 <span class="comment">    int cElem = 0;</span>
00042 <span class="comment">    for (int i = 0; i &lt; vdecl.m_NElements; i++)</span>
00043 <span class="comment">    {</span>
00044 <span class="comment">        elem[cElem].Stream     = vdecl.m_Element[i].m_Stream;</span>
00045 <span class="comment">        elem[cElem].Offset     = vdecl.m_Element[i].m_Offset;</span>
00046 <span class="comment">        elem[cElem].Type       = ConvertVElemType  ( vdecl.m_Element[i].m_Type );</span>
00047 <span class="comment">        elem[cElem].Method     = D3DDECLMETHOD_DEFAULT; </span>
00048 <span class="comment">        elem[cElem].Usage      = ConvertVElemUsage ( vdecl.m_Element[i].m_Usage );</span>
00049 <span class="comment">        elem[cElem].UsageIndex = GetVElemUsageIndex( vdecl.m_Element[i].m_Usage );</span>
00050 <span class="comment">        if (MapsToD3DVElemUsage( vdecl.m_Element[i].m_Usage )) cElem++;</span>
00051 <span class="comment">    }</span>
00052 <span class="comment">    //  end element</span>
00053 <span class="comment">    elem[cElem].Stream     = 0xFF; </span>
00054 <span class="comment">    elem[cElem].Offset     = 0;</span>
00055 <span class="comment">    elem[cElem].Type       = D3DDECLTYPE_UNUSED;</span>
00056 <span class="comment">    elem[cElem].Method     = 0;</span>
00057 <span class="comment">    elem[cElem].Usage      = 0;</span>
00058 <span class="comment">    elem[cElem].UsageIndex = 0;</span>
00059 <span class="comment">    DWORD fvf = 0;</span>
00060 <span class="comment">    HRESULT H=D3DXFVFFromDeclarator( elem, &amp;fvf );</span>
00061 <span class="comment">    //DX_CHK( H );</span>
00062 <span class="comment"></span>
00063 <span class="comment">    return fvf;</span>
00064 <span class="comment">    */</span>    
00065 
00066     DWORD fvf = 0;
00067     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; vdecl.m_NElements; i++)
00068     {
00069         <span class="keywordflow">switch</span> (vdecl.m_Element[i].m_Usage)
00070         {
00071         <span class="keywordflow">case</span> vcPosition     : fvf |= D3DFVF_XYZ;    <span class="keywordflow">break</span>; 
00072         <span class="keywordflow">case</span> vcPositionRHW  : fvf |= D3DFVF_XYZRHW; <span class="keywordflow">break</span>; 
00073 
00074         <span class="keywordflow">case</span> vcBlend0       : fvf |= D3DFVF_XYZB1; <span class="keywordflow">break</span>; 
00075         <span class="keywordflow">case</span> vcBlend1       : fvf |= D3DFVF_XYZB2; fvf &amp;= ~D3DFVF_XYZB1; <span class="keywordflow">break</span>; 
00076         <span class="keywordflow">case</span> vcBlend2       : fvf |= D3DFVF_XYZB3; fvf &amp;= ~D3DFVF_XYZB2; <span class="keywordflow">break</span>; 
00077         <span class="keywordflow">case</span> vcBlend3       : fvf |= D3DFVF_XYZB4; fvf &amp;= ~D3DFVF_XYZB3; <span class="keywordflow">break</span>; 
00078         <span class="keywordflow">case</span> vcBlendIdx     : fvf |= D3DFVF_LASTBETA_UBYTE4; <span class="keywordflow">break</span>; 
00079 
00080         <span class="keywordflow">case</span> vcNormal       : fvf |= D3DFVF_NORMAL; <span class="keywordflow">break</span>;
00081         <span class="keywordflow">case</span> vcBinormal     : <span class="keywordflow">return</span> 0;<span class="comment">//FVF shoud not be used</span>
00082         <span class="keywordflow">case</span> vcTangent      : <span class="keywordflow">return</span> 0;<span class="comment">//</span>
00083         <span class="keywordflow">case</span> vcDiffuse      : fvf |= D3DFVF_DIFFUSE; <span class="keywordflow">break</span>;
00084         <span class="keywordflow">case</span> vcSpecular     : fvf |= D3DFVF_SPECULAR; <span class="keywordflow">break</span>;
00085 
00086         <span class="keywordflow">case</span> vcTexCoor0     : fvf |= D3DFVF_TEX1; <span class="keywordflow">break</span>; 
00087         <span class="keywordflow">case</span> vcTexCoor1     : fvf |= D3DFVF_TEX2; fvf &amp;= ~D3DFVF_TEX1; <span class="keywordflow">break</span>; 
00088         <span class="keywordflow">case</span> vcTexCoor2     : fvf |= D3DFVF_TEX3; fvf &amp;= ~D3DFVF_TEX2; <span class="keywordflow">break</span>; 
00089         <span class="keywordflow">case</span> vcTexCoor3     : fvf |= D3DFVF_TEX4; fvf &amp;= ~D3DFVF_TEX3; <span class="keywordflow">break</span>; 
00090         <span class="keywordflow">case</span> vcTexCoor4     : fvf |= D3DFVF_TEX5; fvf &amp;= ~D3DFVF_TEX4; <span class="keywordflow">break</span>; 
00091         <span class="keywordflow">case</span> vcTexCoor5     : fvf |= D3DFVF_TEX6; fvf &amp;= ~D3DFVF_TEX5; <span class="keywordflow">break</span>; 
00092         <span class="keywordflow">case</span> vcTexCoor6     : fvf |= D3DFVF_TEX7; fvf &amp;= ~D3DFVF_TEX6; <span class="keywordflow">break</span>; 
00093         <span class="keywordflow">case</span> vcTexCoor7     : fvf |= D3DFVF_TEX8; fvf &amp;= ~D3DFVF_TEX7; <span class="keywordflow">break</span>; 
00094         }
00095     }    
00096     <span class="keywordflow">return</span> fvf;
00097 } <span class="comment">// CreateVDecl</span>
</pre></div><hr><address style="align: right;"><small>
Generated on Tue Jun 13 11:14:33 2006 for gRenderDX9 by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.1 using KingsTools</small></address>
</body>
</html>
